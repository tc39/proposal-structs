<!doctype html>
<head><meta charset="utf-8">
<title>JavaScript Structs</title><script src="ecmarkup.js?cache=pqHzUAXr" defer=""></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/base16/solarized-light.min.css"><link rel="stylesheet" href="ecmarkup.css"></head><body><div id="shortcuts-help">
<ul>
  <li><span>Toggle shortcuts help</span><code>?</code></li>
  <li><span>Toggle "can call user code" annotations</span><code>u</code></li>

  <li><span>Jump to search box</span><code>/</code></li>
</ul></div><div id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%; stroke:currentColor" viewBox="0 0 120 120">
      <title>Menu</title>
      <path stroke-width="10" stroke-linecap="round" d="M30,60 h60  M30,30 m0,5 h60  M30,90 m0,-5 h60"></path>
    </svg></div><div id="menu-spacer" class="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#intro" title="Structs, Shared Structs, Unsafe Blocks, and Synchronization Primitives">Structs, Shared Structs, Unsafe Blocks, and Synchronization Primitives</a></li><li><span class="item-toggle">◢</span><a href="#sec-structs" title="Structs"><span class="secnum">1</span> Structs</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-structs-syntax-and-eval" title="Syntax"><span class="secnum">1.1</span> Syntax</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-static-semantics-early-errors" title="Static Semantics: Early Errors"><span class="secnum">1.1.1</span> SS: Early Errors</a></li><li><span class="item-toggle-none"></span><a href="#sec-definestructfield" title="DefineStructField ( receiver, fieldRecord )"><span class="secnum">1.1.2</span> DefineStructField ( <var>receiver</var>, <var>fieldRecord</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-initializestructinstancefieldsandbrands" title="InitializeStructInstanceFieldsAndBrand ( receiver, constructor )"><span class="secnum">1.1.3</span> InitializeStructInstanceFieldsAndBrand ( <var>receiver</var>, <var>constructor</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runfieldinitializer" title="RunFieldInitializer ( receiver, fieldRecord )"><span class="secnum">1.1.4</span> RunFieldInitializer ( <var>receiver</var>, <var>fieldRecord</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runstructinstancefieldinitializers" title="RunStructInstanceFieldInitializers ( receiver, constructor )"><span class="secnum">1.1.5</span> RunStructInstanceFieldInitializers ( <var>receiver</var>, <var>constructor</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-structdefinitionevaluation" title="Runtime Semantics: StructDefinitionEvaluation"><span class="secnum">1.1.6</span> RS: StructDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" title="Runtime Semantics: BindingStructDeclarationEvaluation"><span class="secnum">1.1.7</span> RS: BindingStructDeclarationEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">1.1.8</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-struct-method-exotic-objects" title="Struct Method Exotic Objects"><span class="secnum">1.2</span> Struct Method Exotic Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-struct-method-exotic-objects-call-thisargument-argumentslist" title="[[Call]] ( thisArgument, argumentsList )"><span class="secnum">1.2.1</span> [[Call]] ( <var>thisArgument</var>, <var>argumentsList</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-structmethodcreate" title="StructMethodCreate ( targetMethod )"><span class="secnum">1.2.2</span> StructMethodCreate ( <var>targetMethod</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#changes-to-language-expressions" title="Changes to ECMAScript Language: Expressions"><span class="secnum">1.3</span> Changes to ECMAScript Language: Expressions</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-super-keyword-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">1.3.1</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#changes-to-language-functions-and-classes" title="Changes to ECMAScript Language: Functions and Classes"><span class="secnum">1.4</span> Changes to ECMAScript Language: Functions and Classes</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-definemethod" title="Runtime Semantics: DefineMethod"><span class="secnum">1.4.1</span> RS: DefineMethod</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-changes-to-modules" title="Changes to Modules"><span class="secnum">1.5</span> Changes to Modules</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-exports-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">1.5.1</span> RS: Evaluation</a></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-shared-structs" title="Shared Structs"><span class="secnum">2</span> Shared Structs</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-shared-struct-exotic-objects" title="Shared Struct Exotic Objects"><span class="secnum">2.1</span> Shared Struct Exotic Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-fictional-criticalsection" title="Critical Section for Shared Struct Creation"><span class="secnum">2.1.1</span> Critical Section for Shared Struct Creation</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-entersharedstructcreationcriticalsection" title="EnterSharedStructCreationCriticalSection ( )"><span class="secnum">2.1.1.1</span> EnterSharedStructCreationCriticalSection ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-leavesharedstructcreationcriticalsection" title="LeaveSharedStructCreationCriticalSection ( )"><span class="secnum">2.1.1.2</span> LeaveSharedStructCreationCriticalSection ( )</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-readsharedstructfield" title="ReadSharedStructField ( struct, field, order )"><span class="secnum">2.1.2</span> ReadSharedStructField ( <var>struct</var>, <var>field</var>, <var>order</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-writesharedstructfield" title="WriteSharedStructField ( struct, field, value, order )"><span class="secnum">2.1.3</span> WriteSharedStructField ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>order</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-getownproperty" title="[[GetOwnProperty]] ( P )"><span class="secnum">2.1.4</span> [[GetOwnProperty]] ( <var>P</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-defineownproperty" title="[[DefineOwnProperty]] ( P, Desc )"><span class="secnum">2.1.5</span> [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-hasproperty" title="[[HasProperty]] ( P )"><span class="secnum">2.1.6</span> [[HasProperty]] ( <var>P</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-get" title="[[Get]] ( P, Receiver )"><span class="secnum">2.1.7</span> [[Get]] ( <var>P</var>, <var>Receiver</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-set" title="[[Set]] ( P, V, Receiver )"><span class="secnum">2.1.8</span> [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-delete" title="[[Delete]] ( P )"><span class="secnum">2.1.9</span> [[Delete]] ( <var>P</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-shared-structs-syntax-and-eval" title="Syntax"><span class="secnum">2.2</span> Syntax</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier" title="Static Semantics: ContainsInstancePrivateIdentifier"><span class="secnum">2.2.1</span> SS: ContainsInstancePrivateIdentifier</a></li><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-static-semantics-containsinstancemethod" title="Static Semantics: ContainsInstanceMethod"><span class="secnum">2.2.2</span> SS: ContainsInstanceMethod</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-definitions-static-semantics-early-errors" title="Static Semantics: Early Errors"><span class="secnum">2.2.3</span> SS: Early Errors</a></li><li><span class="item-toggle-none"></span><a href="#sec-canbesharedacrossagents" title="CanBeSharedAcrossAgents ( val )"><span class="secnum">2.2.4</span> CanBeSharedAcrossAgents ( <var>val</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-definesharedstructfield" title="DefineSharedStructField ( receiver, fieldRecord )"><span class="secnum">2.2.5</span> DefineSharedStructField ( <var>receiver</var>, <var>fieldRecord</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" title="Runtime Semantics: SharedStructDefinitionEvaluation"><span class="secnum">2.2.6</span> RS: SharedStructDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-bindingsharedstructdeclarationevaluation" title="Runtime Semantics: BindingStructDeclarationEvaluation"><span class="secnum">2.2.7</span> RS: BindingStructDeclarationEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">2.2.8</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-changes-to-atomics-object" title="Changes to the Atomics Object"><span class="secnum">2.3</span> Changes to the Atomics Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomiccompareexchangeinsharedstruct" title="AtomicCompareExchangeInSharedStruct ( struct, field, expectedValue, replacementValue )"><span class="secnum">2.3.1</span> AtomicCompareExchangeInSharedStruct ( <var>struct</var>, <var>field</var>, <var>expectedValue</var>, <var>replacementValue</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomicreadmodifywriteinsharedstruct" title="AtomicReadModifyWriteInSharedStruct ( struct, field, value, op )"><span class="secnum">2.3.2</span> AtomicReadModifyWriteInSharedStruct ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>op</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.compareexchange-struct" title="Atomics.compareExchange ( typedArraytypedArrayOrStruct, indexindexOrField, expectedValue, replacementValue )"><span class="secnum">2.3.3</span> Atomics.compareExchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>expectedValue</var>, <var>replacementValue</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.exchange-struct" title="Atomics.exchange ( typedArraytypedArrayOrStruct, indexindexOrField, value )"><span class="secnum">2.3.4</span> Atomics.exchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.load-struct" title="Atomics.load ( typedArraytypedArrayOrStruct, indexindexOrField )"><span class="secnum">2.3.5</span> Atomics.load ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.store-struct" title="Atomics.store ( typedArraytypedArrayOrStruct, indexindexOrField, value )"><span class="secnum">2.3.6</span> Atomics.store ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-changes-to-memory-model" title="Changes to the Memory Model"><span class="secnum">2.4</span> Changes to the Memory Model</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-memory-model-fundamentals" title="Memory Model Fundamentals"><span class="secnum">2.4.1</span> Memory Model Fundamentals</a></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-shared-arrays" title="Shared Array Object"><span class="secnum">3</span> Shared Array Object</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-shared-array-constructor" title="The SharedArray Constructor"><span class="secnum">3.1</span> The SharedArray Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-sharedarraycreate" title="SharedArrayCreate ( length )"><span class="secnum">3.1.1</span> SharedArrayCreate ( <var>length</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-sharedarray" title="SharedArray ( ...values )"><span class="secnum">3.1.2</span> SharedArray ( ...<var>values</var> )</a></li></ol></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-copyright-and-software-license" title="Copyright &amp; Software License"><span class="secnum">A</span> Copyright &amp; Software License</a></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 1 Draft / September 20, 2024</h1><h1 class="title">JavaScript Structs</h1>

<emu-intro id="intro">
  <h1>Structs, Shared Structs, Unsafe Blocks, and Synchronization Primitives</h1>
  <p>We extend the JS language with fixed-layout objects both for unshared and shared uses, unsafe blocks to syntactically limit the scope of where racy accesses may be performed, and high-level synchronization primitive APIs. This spec draft is organized by logical feature.</p>
</emu-intro>

<emu-clause id="sec-structs">
  <h1><span class="secnum">1</span> Structs</h1>
  <p>Structs are fixed-layout objects. They are constructed with the integrity level <emu-const>sealed</emu-const>, and have all declared fields initialized before the instance is made available to user code. They may only extend other structs. Their instance methods are non-generic, and throw <emu-val>TypeError</emu-val> exceptions when the <emu-val>this</emu-val> value is not either an instance of the struct declaration within which the method was declared, or a subclass of that struct declaration.</p>

  <emu-clause id="sec-structs-syntax-and-eval">
    <h1><span class="secnum">1.1</span> Syntax</h1>

    <ins class="block">
    <emu-grammar type="definition"><emu-production name="StructDeclaration" params="Yield, Await, Default">
    <emu-nt params="Yield, Await, Default"><a href="#prod-StructDeclaration">StructDeclaration</a><emu-mods><emu-params>[Yield, Await, Default]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="gllzxqf2" id="prod-e2ZCr45r">
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
        <emu-nt params="?Yield, ?Await" id="_ref_137"><a href="#prod-StructTail">StructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="2blgvvy1" constraints="+Default" id="prod-sut0XC0z"><emu-constraints>[+Default]</emu-constraints>
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await" id="_ref_138"><a href="#prod-StructTail">StructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
<emu-production name="StructExpression" params="Yield, Await">
    <emu-nt params="Yield, Await"><a href="#prod-StructExpression">StructExpression</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="jmz9mqcn" id="prod-jM8QIEAP">
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await" optional=""><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-nt params="?Yield, ?Await" id="_ref_139"><a href="#prod-StructTail">StructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
<emu-production name="StructTail" params="Yield, Await" id="prod-StructTail">
    <emu-nt params="Yield, Await"><a href="#prod-StructTail">StructTail</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="kgpn8rwq" id="prod-EyLs88eE">
        <emu-nt params="?Yield, ?Await" optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt params="?Yield, ?Await" optional="" id="_ref_140"><a href="#prod-StructBody">StructBody</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
<emu-production name="StructBody" params="Yield, Await" id="prod-StructBody">
    <emu-nt params="Yield, Await"><a href="#prod-StructBody">StructBody</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="hi6rf-a8">
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
    <emu-note><span class="note">Note</span><div class="note-contents">
      <p>A struct definition is always <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.es/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>.</p>
    </div></emu-note>

    <emu-clause id="sec-struct-definitions-static-semantics-early-errors">
      <h1><span class="secnum">1.1.1</span> Static Semantics: Early Errors</h1>
      <emu-grammar><emu-production name="StructBody" collapsed="">
    <emu-nt><a href="#prod-StructBody">StructBody</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="1y1dunax"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <ul>
        <li>
          It is a SyntaxError if <emu-xref aoid="PrototypePropertyNameList"><a href="https://tc39.es/ecma262/#sec-static-semantics-prototypepropertynamelist">PrototypePropertyNameList</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> contains more than one occurrence of <emu-val>"constructor"</emu-val>.
        </li>
        <li>
          It is a Syntax Error if the <emu-xref aoid="PrivateBoundIdentifiers"><a href="https://tc39.es/ecma262/#sec-static-semantics-privateboundidentifiers">PrivateBoundIdentifiers</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> contains any duplicate entries, unless the name is used once for a getter and once for a setter and in no other entries, and the getter and setter are either both static or both non-static.
        </li>
      </ul>
    </emu-clause>

    <emu-clause id="sec-definestructfield" type="abstract operation" aoid="DefineStructField">
      <h1><span class="secnum">1.1.2</span> DefineStructField ( <var>receiver</var>, <var>fieldRecord</var> )</h1>
      <p>The abstract operation DefineStructField takes arguments <var>receiver</var> (an Object) and <var>fieldRecord</var> (a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>fieldName</var> be <var>fieldRecord</var>.[[Name]].</li><li>If <var>fieldName</var> is a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref>, then<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateFieldAdd"><a href="https://tc39.es/ecma262/#sec-privatefieldadd">PrivateFieldAdd</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, <emu-val>undefined</emu-val>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>fieldName</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>.</li><li>Perform !&nbsp;<emu-xref aoid="DefinePropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, PropertyDescriptor { [[Value]]: <emu-val>undefined</emu-val>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>true</emu-val>, [[Configurable]]: <emu-val>false</emu-val> }).</li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-initializestructinstancefieldsandbrands" type="abstract operation" aoid="InitializeStructInstanceFieldsAndBrand">
      <h1><span class="secnum">1.1.3</span> InitializeStructInstanceFieldsAndBrand ( <var>receiver</var>, <var>constructor</var> )</h1>
      <p>The abstract operation InitializeStructInstanceFieldsAndBrand takes arguments <var>receiver</var> (an Object) and <var>constructor</var> (an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>constructor</var>.[[ConstructorKind]] is <emu-const>derived</emu-const>, then<ol><li>Let <var>parent</var> be !&nbsp;<var>constructor</var>.[[GetPrototypeOf]]().</li><li>Perform <emu-xref aoid="InitializeStructInstanceFieldsAndBrand" id="_ref_15"><a href="#sec-initializestructinstancefieldsandbrands">InitializeStructInstanceFieldsAndBrand</a></emu-xref>(<var>receiver</var>, <var>parent</var>).</li></ol></li><li>If <var>constructor</var> has a [[StructBrand]] internal slot, then<ol><li>Prepend <var>constructor</var>.[[StructBrand]] to <var>receiver</var>.[[StructBrands]].</li><li>NOTE: <emu-xref href="#shared-struct-exotic-object" id="_ref_16"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructors</a></emu-xref> do not have a [[StructBrand]] internal slot because per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes is currently an open design question and are not included in this draft. Without per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, <emu-xref href="#shared-struct-exotic-object" id="_ref_17"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> cannot have methods, and there are no users of <emu-xref href="#shared-struct-exotic-object" id="_ref_18"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> brands.</li></ol></li><li>Let <var>methods</var> be the value of <var>constructor</var>.[[PrivateMethods]].</li><li>For each <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>method</var> of <var>methods</var>, do<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateMethodOrAccessorAdd"><a href="https://tc39.es/ecma262/#sec-privatemethodoraccessoradd">PrivateMethodOrAccessorAdd</a></emu-xref>(<var>receiver</var>, <var>method</var>).</li></ol></li><li>Let <var>fields</var> be the value of <var>constructor</var>.[[Fields]].</li><li>For each element <var>fieldRecord</var> of <var>fields</var>, do<ol><li>Perform <emu-xref aoid="DefineStructField" id="_ref_19"><a href="#sec-definestructfield">DefineStructField</a></emu-xref>(<var>receiver</var>, <var>fieldRecord</var>).</li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runfieldinitializer" type="abstract operation" aoid="RunFieldInitializer">
      <h1><span class="secnum">1.1.4</span> RunFieldInitializer ( <var>receiver</var>, <var>fieldRecord</var> )</h1>
      <p>The abstract operation RunFieldInitializer takes arguments <var>receiver</var> (an Object) and <var>fieldRecord</var> (a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-const>unused</emu-const> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>fieldName</var> be <var>fieldRecord</var>.[[Name]].</li><li>Let <var>initializer</var> be <var>fieldRecord</var>.[[Initializer]].</li><li>If <var>initializer</var> is not <emu-const>empty</emu-const>, then<ol><li>Let <var>initValue</var> be ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>initializer</var>, <var>receiver</var>).</li><li>If <var>fieldName</var> is a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="PrivateSet"><a href="https://tc39.es/ecma262/#sec-privateset" class="e-user-code">PrivateSet</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, <var>initValue</var>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>fieldName</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>.</li><li>Perform ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-definepropertyorthrow" class="e-user-code">DefinePropertyOrThrow</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, PropertyDescriptor { [[Value]]: <var>initValue</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>true</emu-val>, [[Configurable]]: <emu-val>false</emu-val> }).</li></ol></li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runstructinstancefieldinitializers" type="abstract operation" aoid="RunStructInstanceFieldInitializers">
      <h1><span class="secnum">1.1.5</span> RunStructInstanceFieldInitializers ( <var>receiver</var>, <var>constructor</var> )</h1>
      <p>The abstract operation RunStructInstanceFieldInitializers takes arguments <var>receiver</var> (an Object) and <var>constructor</var> (an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-const>unused</emu-const> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>constructor</var>.[[ConstructorKind]] is <emu-const>derived</emu-const>, then<ol><li>Let <var>parent</var> be !&nbsp;<var>constructor</var>.[[GetPrototypeOf]]().</li><li>Perform ?&nbsp;<emu-xref aoid="RunStructInstanceFieldInitializers" id="_ref_20"><a href="#sec-runstructinstancefieldinitializers" class="e-user-code">RunStructInstanceFieldInitializers</a></emu-xref>(<var>receiver</var>, <var>parent</var>).</li></ol></li><li>Let <var>fields</var> be the value of <var>constructor</var>.[[Fields]].</li><li>For each element <var>fieldRecord</var> of <var>fields</var>, do<ol><li>Perform ?&nbsp;<emu-xref aoid="RunFieldInitializer" id="_ref_21"><a href="#sec-runfieldinitializer" class="e-user-code">RunFieldInitializer</a></emu-xref>(<var>receiver</var>, <var>fieldRecord</var>).</li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-structdefinitionevaluation" type="sdo" aoid="StructDefinitionEvaluation">
      <h1><span class="secnum">1.1.6</span> Runtime Semantics: StructDefinitionEvaluation</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> StructDefinitionEvaluation takes arguments <var>structBinding</var> (a String or <emu-val>undefined</emu-val>) and <var>structName</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="StructTail" collapsed="">
    <emu-nt><a href="#prod-StructTail">StructTail</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="cktgtla1" id="prod-COgM9bSC">
        <emu-nt optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt optional="" id="_ref_141"><a href="#prod-StructBody">StructBody</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>env</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>structEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment"><a href="https://tc39.es/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>env</var>).</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.CreateImmutableBinding(<var>structBinding</var>, <emu-val>true</emu-val>).</li></ol></li><li>Let <var>outerPrivateEnvironment</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment.</li><li>Let <var>classPrivateEnvironment</var> be <emu-xref aoid="NewPrivateEnvironment"><a href="https://tc39.es/ecma262/#sec-newprivateenvironment">NewPrivateEnvironment</a></emu-xref>(<var>outerPrivateEnvironment</var>).</li><li>If <emu-nt id="_ref_142"><a href="#prod-StructBody">StructBody</a></emu-nt> is present, then<ol><li>For each String <var>dn</var> of the <emu-xref aoid="PrivateBoundIdentifiers"><a href="https://tc39.es/ecma262/#sec-static-semantics-privateboundidentifiers">PrivateBoundIdentifiers</a></emu-xref> of <emu-nt id="_ref_143"><a href="#prod-StructBody">StructBody</a></emu-nt>, do<ol><li>If <var>classPrivateEnvironment</var>.[[Names]] contains a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> <var>pn</var> such that <var>pn</var>.[[Description]] is <var>dn</var>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: This is only possible for getter/setter pairs.</li></ol></li><li>Else,<ol><li>Let <var>name</var> be a new <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> whose [[Description]] is <var>dn</var>.</li><li>Append <var>name</var> to <var>classPrivateEnvironment</var>.[[Names]].</li></ol></li></ol></li></ol></li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is not present, then<ol><li>Let <var>protoParent</var> be <emu-xref href="#sec-properties-of-the-object-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-object-prototype-object">%Object.prototype%</a></emu-xref>.</li><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else,<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>NOTE: The <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment is <var>outerPrivateEnvironment</var> when evaluating <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt>.</li><li>Let <var>superclassRef</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt>).</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Let <var>superclass</var> be ?&nbsp;<emu-xref aoid="GetValue"><a href="https://tc39.es/ecma262/#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(? <var>superclassRef</var>).</li><li>If <var>superclass</var> is <emu-val>null</emu-val>, then<ol><li>Let <var>protoParent</var> be <emu-val>null</emu-val>.</li><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else if <var>superclass</var> does not have a [[IsStructConstructor]] internal slot, then<ol><li>Throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>Else,<ol><li>Let <var>protoParent</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>superclass</var>, <emu-val>"prototype"</emu-val>).</li><li>If <var>protoParent</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is not an Object</a></emu-xref> and <var>protoParent</var> is not <emu-val>null</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>constructorParent</var> be <var>superclass</var>.</li></ol></li></ol></li><li>Let <var>proto</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<var>protoParent</var>, « [[StructBrand]] »).</li><li>Let <var>structSerial</var> be the value of GlobalStructSerial.</li><li>Set <var>proto</var>.[[StructBrand]] to <var>structSerial</var>.</li><li>Set GlobalStructSerial to GlobalStructSerial + 1.</li><li>NOTE: GlobalStructSerial is a monotonically increasing <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref> that is globally available. It is shared by all <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">realms</a></emu-xref>. Prior to the evaluation of any ECMAScript code, it is initialized to 0.</li><li>NOTE: Structs have one-shot construction, with the user-defined "<emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>" method performing post-construction initialization. By the time ECMAScript code has access to a struct instance, it already has all of its declared fields as own properties.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>classPrivateEnvironment</var>.</li><li>If <emu-nt id="_ref_144"><a href="#prod-StructBody">StructBody</a></emu-nt> is not present, let <var>initializerParseNode</var> be <emu-const>empty</emu-const>.</li><li>Else, let <var>initializerParseNode</var> be <emu-xref aoid="ConstructorMethod"><a href="https://tc39.es/ecma262/#sec-static-semantics-constructormethod">ConstructorMethod</a></emu-xref> of <emu-nt id="_ref_145"><a href="#prod-StructBody">StructBody</a></emu-nt>.</li><li>If <var>initializerParseNode</var> is <emu-const>empty</emu-const>, then<ol><li>Let <var>initializer</var> be <emu-const>empty</emu-const>.</li></ol></li><li>Else,<ol><li>Let <var>initializerInfo</var> be ?&nbsp;<emu-xref aoid="DefineMethod" id="_ref_22"><a href="#sec-runtime-semantics-definemethod" class="e-user-code">DefineMethod</a></emu-xref> of <var>initializerParseNode</var> with arguments <var>proto</var> and <var>constructorParent</var>.</li><li>Let <var>initializer</var> be <var>initializerInfo</var>.[[Closure]].</li><li>Perform <emu-xref aoid="SetFunctionName"><a href="https://tc39.es/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>initializer</var>, <var>structName</var>).</li></ol></li><li>Let <var>constructor</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>initializer</var> and <var>structSerial</var> and performs the following steps when called:<ol><li>Let <var>args</var> be the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of arguments that was passed to this function by [[Call]] or [[Construct]].</li><li>Let <var>F</var> be the <emu-xref href="#active-function-object"><a href="https://tc39.es/ecma262/#active-function-object">active function object</a></emu-xref>.</li><li>If NewTarget is not <var>F</var>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>result</var> be ?&nbsp;<emu-xref aoid="OrdinaryCreateFromConstructor"><a href="https://tc39.es/ecma262/#sec-ordinarycreatefromconstructor" class="e-user-code">OrdinaryCreateFromConstructor</a></emu-xref>(NewTarget, <emu-val>"%Object.prototype%"</emu-val>, « [[StructBrands]] »).</li><li>Set <var>result</var>.[[StructBrands]] to « <var>structSerial</var> ».</li><li>Perform <emu-xref aoid="InitializeStructInstanceFieldsAndBrand" id="_ref_23"><a href="#sec-initializestructinstancefieldsandbrands">InitializeStructInstanceFieldsAndBrand</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>Perform !&nbsp;<var>result</var>.[[PreventExtensions]]().</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="TestIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-testintegritylevel">TestIntegrityLevel</a></emu-xref>(<var>result</var>, <emu-const>sealed</emu-const>) is <emu-val>true</emu-val>.</li><li>Perform ?&nbsp;<emu-xref aoid="RunStructInstanceFieldInitializers" id="_ref_24"><a href="#sec-runstructinstancefieldinitializers" class="e-user-code">RunStructInstanceFieldInitializers</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>If <var>initializer</var> is not <emu-const>empty</emu-const>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>initializer</var>, <var>result</var>).</li></ol></li><li>Return <var>result</var>.</li></ol></li><li>Let <var>F</var> be <emu-xref aoid="CreateBuiltinFunction"><a href="https://tc39.es/ecma262/#sec-createbuiltinfunction">CreateBuiltinFunction</a></emu-xref>(<var>constructor</var>, 0, structName, « [[ConstructorKind]], [[SourceText]], [[StructBrand]], [[StructInitializer]], [[IsStructConstructor]] », <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>, <var>constructorParent</var>).</li><li>Perform <emu-xref aoid="MakeConstructor"><a href="https://tc39.es/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>F</var>, <emu-val>false</emu-val>, <var>proto</var>).</li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is present, set <var>F</var>.[[ConstructorKind]] to <emu-const>derived</emu-const>.</li><li>Set <var>F</var>.[[StructInitializer]] to <var>initializer</var>.</li><li>Set <var>F</var>.[[StructBrand]] to <var>structSerial</var>.</li><li>Set <var>F</var>.[[IsStructConstructor]] to <emu-val>true</emu-val>.</li><li>If <emu-nt id="_ref_146"><a href="#prod-StructBody">StructBody</a></emu-nt> is not present, let <var>elements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Else, let <var>elements</var> be <emu-xref aoid="NonConstructorElements"><a href="https://tc39.es/ecma262/#sec-static-semantics-nonconstructorelements">NonConstructorElements</a></emu-xref> of <emu-nt id="_ref_147"><a href="#prod-StructBody">StructBody</a></emu-nt>.</li><li>Let <var>instancePrivateMethods</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>staticPrivateMethods</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>instanceFields</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>staticElements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>For each <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <var>e</var> of <var>elements</var>, do<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, then<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>proto</var>).</li></ol></li><li>Else,<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>F</var>).</li></ol></li><li>If <var>element</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>element</var>.</li></ol></li><li>Set <var>element</var> to !&nbsp;<var>element</var>.</li><li>If <var>element</var> is a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.[[Kind]] is either <emu-const>method</emu-const> or <emu-const>accessor</emu-const>.</li><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, let <var>container</var> be <var>instancePrivateMethods</var>.</li><li>Else, let <var>container</var> be <var>staticPrivateMethods</var>.</li><li>If <var>container</var> contains a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>pe</var> such that <var>pe</var>.[[Key]] is <var>element</var>.[[Key]], then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.[[Kind]] and <var>pe</var>.[[Kind]] are both <emu-const>accessor</emu-const>.</li><li>If <var>element</var>.[[Get]] is <emu-val>undefined</emu-val>, then<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { [[Key]]: <var>element</var>.[[Key]], [[Kind]]: <emu-const>accessor</emu-const>, [[Get]]: <var>pe</var>.[[Get]], [[Set]]: <var>element</var>.[[Set]] }.</li></ol></li><li>Else,<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { [[Key]]: <var>element</var>.[[Key]], [[Kind]]: <emu-const>accessor</emu-const>, [[Get]]: <var>element</var>.[[Get]], [[Set]]: <var>pe</var>.[[Set]] }.</li></ol></li><li>Replace <var>pe</var> in <var>container</var> with <var>combined</var>.</li></ol></li><li>Else,<ol><li>Append <var>element</var> to <var>container</var>.</li></ol></li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, append <var>element</var> to <var>instanceFields</var>.</li><li>Else, append <var>element</var> to <var>staticElements</var>.</li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>, then<ol><li>Append <var>element</var> to <var>staticElements</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.InitializeBinding(<var>structBinding</var>, <var>F</var>).</li></ol></li><li>Set <var>F</var>.[[PrivateMethods]] to <var>instancePrivateMethods</var>.</li><li>Set <var>F</var>.[[Fields]] to <var>instanceFields</var>.</li><li>For each <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>method</var> of <var>staticPrivateMethods</var>, do<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateMethodOrAccessorAdd"><a href="https://tc39.es/ecma262/#sec-privatemethodoraccessoradd">PrivateMethodOrAccessorAdd</a></emu-xref>(<var>F</var>, <var>method</var>).</li></ol></li><li>For each element <var>elementRecord</var> of <var>staticElements</var>, do<ol><li>If <var>elementRecord</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="DefineField"><a href="https://tc39.es/ecma262/#sec-definefield" class="e-user-code">DefineField</a></emu-xref>(<var>F</var>, <var>elementRecord</var>)).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>elementRecord</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>.</li><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>elementRecord</var>.[[BodyFunction]], <var>F</var>)).</li></ol></li><li>If <var>result</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>result</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Perform !&nbsp;<emu-xref aoid="SetIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-setintegritylevel">SetIntegrityLevel</a></emu-xref>(<var>proto</var>, <emu-const>sealed</emu-const>).</li><li>Return <var>F</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-bindingstructdeclarationevaluation" type="sdo" aoid="BindingStructDeclarationEvaluation">
      <h1><span class="secnum">1.1.7</span> Runtime Semantics: BindingStructDeclarationEvaluation</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> BindingStructDeclarationEvaluation takes no arguments and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="7oevws9p" id="prod-s2PPFPsU">
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_148"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>structName</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="StructDefinitionEvaluation" id="_ref_25"><a href="#sec-runtime-semantics-structdefinitionevaluation" class="e-user-code">StructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_149"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <var>structName</var> and <var>structName</var>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_150"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeBoundName"><a href="https://tc39.es/ecma262/#sec-initializeboundname" class="e-user-code">InitializeBoundName</a></emu-xref>(<var>structName</var>, <var>value</var>, <var>env</var>).</li><li>Return <var>value</var>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="ybqt6rv-" id="prod-3t_ysv4H">
        <emu-t>struct</emu-t>
        <emu-nt id="_ref_151"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="StructDefinitionEvaluation" id="_ref_26"><a href="#sec-runtime-semantics-structdefinitionevaluation" class="e-user-code">StructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_152"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <emu-val>undefined</emu-val> and <emu-val>"default"</emu-val>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_153"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-struct-definitions-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">1.1.8</span> Runtime Semantics: Evaluation</h1>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="7oevws9p" id="prod-CJdKR16y">
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_154"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="BindingStructDeclarationEvaluation" id="_ref_27"><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" class="e-user-code">BindingStructDeclarationEvaluation</a></emu-xref> of this <emu-nt id="_ref_155"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <emu-const>empty</emu-const>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructExpression" collapsed="">
    <emu-nt><a href="#prod-StructExpression">StructExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="ybqt6rv-" id="prod-Zme3aNfH">
        <emu-t>struct</emu-t>
        <emu-nt id="_ref_156"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="StructDefinitionEvaluation" id="_ref_28"><a href="#sec-runtime-semantics-structdefinitionevaluation" class="e-user-code">StructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_157"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <emu-val>undefined</emu-val> and <emu-val>""</emu-val>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_158"><a href="#prod-StructExpression">StructExpression</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructExpression" collapsed="">
    <emu-nt><a href="#prod-StructExpression">StructExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="7oevws9p" id="prod-Zjo3aZoe">
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_159"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>structName</var> be <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="StructDefinitionEvaluation" id="_ref_29"><a href="#sec-runtime-semantics-structdefinitionevaluation" class="e-user-code">StructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_160"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <var>structName</var> and <var>structName</var>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_161"><a href="#prod-StructExpression">StructExpression</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="sec-struct-method-exotic-objects">
    <h1><span class="secnum">1.2</span> Struct Method Exotic Objects</h1>
    <ins class="block">

    <p>A <emu-xref href="#struct-method-exotic-object" id="_ref_30"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> is an <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic object</a></emu-xref> that wraps another method. A <emu-xref href="#struct-method-exotic-object" id="_ref_31"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> is callable (it has a [[Call]] internal method). Calling a <emu-xref href="#struct-method-exotic-object" id="_ref_32"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> checks if the <emu-val>this</emu-val> value is a struct instance constructed by the same struct declaration that defined the method, then in calls its wrapped method.</p>

    <p>An object is a <dfn id="struct-method-exotic-object" variants="struct method exotic objects">struct method exotic object</dfn> if its [[Call]] internal method uses the following implementation, and its other essential internal methods use the definitions found in <emu-xref href="#sec-ordinary-object-internal-methods-and-internal-slots"><a href="https://tc39.es/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots">10.1</a></emu-xref>. These methods are installed in <emu-xref aoid="StructMethodCreate" id="_ref_33"><a href="#sec-structmethodcreate">StructMethodCreate</a></emu-xref>.</p>

    <p><emu-xref href="#struct-method-exotic-object" id="_ref_34"><a href="#struct-method-exotic-object">Struct method exotic objects</a></emu-xref> do not have the internal slots of ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function objects</a></emu-xref> listed in <emu-xref href="#table-internal-slots-of-ecmascript-function-objects"><a href="https://tc39.es/ecma262/#table-internal-slots-of-ecmascript-function-objects">Table 30</a></emu-xref>. Instead they have the internal slots listed in <emu-xref href="#table-internal-slots-of-struct-method-exotic-objects" id="_ref_0"><a href="#table-internal-slots-of-struct-method-exotic-objects">Table 1</a></emu-xref>, in addition to [[Prototype]] and [[Extensible]].</p>
    <emu-table id="table-internal-slots-of-struct-method-exotic-objects" caption="Internal Slots of Struct Method Exotic Objects"><figure><figcaption>Table 1: Internal Slots of Struct Method Exotic Objects</figcaption>
      <table>
        <thead>
          <tr>
            <th>
              Internal Slot
            </th>
            <th>
              Type
            </th>
            <th>
              Description
            </th>
          </tr>
        </thead>
        <tbody><tr>
          <td>
            [[BoundTargetMethod]]
          </td>
          <td>
            a callable Object
          </td>
          <td>
            The wrapped method object.
          </td>
        </tr>
      </tbody></table>
    </figure></emu-table>

    <emu-clause id="sec-struct-method-exotic-objects-call-thisargument-argumentslist" type="internal method">
      <h1><span class="secnum">1.2.1</span> [[Call]] ( <var>thisArgument</var>, <var>argumentsList</var> )</h1>
      <p>The [[Call]] internal method of a <emu-xref href="#struct-method-exotic-object" id="_ref_35"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> <var>F</var> takes arguments <var>thisArgument</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and <var>argumentsList</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language values</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>target</var> be <var>F</var>.[[BoundTargetMethod]].</li><li>Let <var>homeObject</var> be <var>target</var>.[[HomeObject]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>homeObject</var> is not <emu-val>undefined</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>homeObject</var> has a [[StructBrand]] internal slot.</li><li>If <var>thisArgument</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is not an Object</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>thisArgument</var> does not have a [[StructBrands]] internal slot, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>thisArgument</var>.[[StructBrands]] does not contain <var>homeObject</var>.[[StructBrand]], throw a <emu-val>TypeError</emu-val> exception.</li><li>Return ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>target</var>, <var>thisArgument</var>, argumentsList_).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-structmethodcreate" type="abstract operation" aoid="StructMethodCreate">
      <h1><span class="secnum">1.2.2</span> StructMethodCreate ( <var>targetMethod</var> )</h1>
      <p>The abstract operation StructMethodCreate takes argument <var>targetMethod</var> (a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It is used to specify the creation of new <emu-xref href="#struct-method-exotic-object" id="_ref_36"><a href="#struct-method-exotic-object">struct method exotic objects</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>proto</var> be ?&nbsp;<span class="e-user-code"><var>targetMethod</var>.[[GetPrototypeOf]]</span>().</li><li>Let <var>internalSlotsList</var> be the <emu-xref href="#list-concatenation"><a href="https://tc39.es/ecma262/#list-concatenation">list-concatenation</a></emu-xref> of « [[Prototype]], [[Extensible]] » and the internal slots listed in <emu-xref href="#table-internal-slots-of-struct-method-exotic-objects" id="_ref_1"><a href="#table-internal-slots-of-struct-method-exotic-objects">Table 1</a></emu-xref>.</li><li>Let <var>obj</var> be <emu-xref aoid="MakeBasicObject"><a href="https://tc39.es/ecma262/#sec-makebasicobject">MakeBasicObject</a></emu-xref>(<var>internalSlotsList</var>).</li><li>Set <var>obj</var>.[[Prototype]] to <var>proto</var>.</li><li>Set <var>obj</var>.[[Call]] as described in <emu-xref href="#sec-struct-method-exotic-objects-call-thisargument-argumentslist" id="_ref_2"><a href="#sec-struct-method-exotic-objects-call-thisargument-argumentslist">1.2.1</a></emu-xref>.</li><li>Set <var>obj</var>.[[BoundTargetMethod]] to <var>targetMethod</var>.</li><li>Return <var>obj</var>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="changes-to-language-expressions">
    <h1><span class="secnum">1.3</span> Changes to ECMAScript Language: Expressions</h1>
    <emu-clause id="sec-super-keyword-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">1.3.1</span> Runtime Semantics: Evaluation</h1>
      <emu-grammar><emu-production name="SuperCall" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-SuperCall">SuperCall</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="qdmdlzzo">
        <emu-t>super</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
        <emu-alg><ol><li>Let <var>newTarget</var> be <emu-xref aoid="GetNewTarget"><a href="https://tc39.es/ecma262/#sec-getnewtarget">GetNewTarget</a></emu-xref>().</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>newTarget</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is an Object</a></emu-xref>.</li><li>Let <var>func</var> be <emu-xref aoid="GetSuperConstructor"><a href="https://tc39.es/ecma262/#sec-getsuperconstructor">GetSuperConstructor</a></emu-xref>().</li><li>Let <var>argList</var> be ?&nbsp;<emu-xref aoid="ArgumentListEvaluation"><a href="https://tc39.es/ecma262/#sec-runtime-semantics-argumentlistevaluation" class="e-user-code">ArgumentListEvaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>.</li><li>If <emu-xref aoid="IsConstructor"><a href="https://tc39.es/ecma262/#sec-isconstructor">IsConstructor</a></emu-xref>(<var>func</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li><ins>If <var>func</var> has a [[StructInitializer]] internal slot, then</ins><ol><li><ins>If <var>func</var>.[[StructInitializer]] is not <emu-const>empty</emu-const>, then</ins><ol><li><ins>Let <var>envRec</var> be <emu-xref aoid="GetThisEnvironment"><a href="https://tc39.es/ecma262/#sec-getthisenvironment">GetThisEnvironment</a></emu-xref>().</ins></li><li><ins>Let <var>thisValue</var> be <var>envRec</var>.GetThisBinding().</ins></li><li><ins>Return ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>func</var>.[[StructInitializer]], <var>thisValue</var>).</ins></li></ol></li><li><ins>Else,</ins><ol><li><ins>Return <emu-val>undefined</emu-val>.</ins></li></ol></li></ol></li><li>Let <var>result</var> be ?&nbsp;<emu-xref aoid="Construct"><a href="https://tc39.es/ecma262/#sec-construct" class="e-user-code">Construct</a></emu-xref>(<var>func</var>, <var>argList</var>, <var>newTarget</var>).</li><li>Let <var>thisER</var> be <emu-xref aoid="GetThisEnvironment"><a href="https://tc39.es/ecma262/#sec-getthisenvironment">GetThisEnvironment</a></emu-xref>().</li><li>Perform ?&nbsp;<var>thisER</var>.BindThisValue(<var>result</var>).</li><li>Let <var>F</var> be <var>thisER</var>.[[FunctionObject]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>F</var> is an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeInstanceElements"><a href="https://tc39.es/ecma262/#sec-initializeinstanceelements" class="e-user-code">InitializeInstanceElements</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>Return <var>result</var>.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="changes-to-language-functions-and-classes">
    <h1><span class="secnum">1.4</span> Changes to ECMAScript Language: Functions and Classes</h1>
    <emu-clause id="sec-runtime-semantics-definemethod" type="sdo" aoid="DefineMethod">
      <h1><span class="secnum">1.4.1</span> Runtime Semantics: DefineMethod</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> DefineMethod takes argument <var>object</var> (an Object) and optional argument <var>functionPrototype</var> (an Object) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> with fields [[Key]] (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and [[Closure]] (an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="MethodDefinition" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="f2ayx1_q">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementName">ClassElementName</a></emu-nt>
        <emu-t>(</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt>
        <emu-t>)</emu-t>
        <emu-t>{</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>propKey</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementName">ClassElementName</a></emu-nt>.</li><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>privateEnv</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment.</li><li>If <var>functionPrototype</var> is present, then<ol><li>Let <var>prototype</var> be <var>functionPrototype</var>.</li></ol></li><li>Else,<ol><li>Let <var>prototype</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Let <var>sourceText</var> be the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt>.</li><li>Let <var>closure</var> be <emu-xref aoid="OrdinaryFunctionCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryfunctioncreate">OrdinaryFunctionCreate</a></emu-xref>(<var>prototype</var>, <var>sourceText</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.es/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <emu-const>non-lexical-this</emu-const>, <var>env</var>, <var>privateEnv</var>).</li><li>Perform <emu-xref aoid="MakeMethod"><a href="https://tc39.es/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li><ins>If <var>object</var> has a [[StructBrand]] internal slot, then</ins><ol><li><ins>NOTE: Struct instance methods' home object have a [[StructBrand]] internal slot.</ins></li><li><ins>Set <var>closure</var> to ?&nbsp;<emu-xref aoid="StructMethodCreate" id="_ref_37"><a href="#sec-structmethodcreate" class="e-user-code">StructMethodCreate</a></emu-xref>(<var>closure</var>).</ins></li></ol></li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { [[Key]]: <var>propKey</var>, [[Closure]]: <var>closure</var> }.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-changes-to-modules">
    <h1><span class="secnum">1.5</span> Changes to Modules</h1>

    <emu-grammar type="definition"><emu-production name="ExportDeclaration" id="prod-ExportDeclaration">
    <emu-nt><a href="#prod-ExportDeclaration">ExportDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="4kqfdugp">
        <emu-t>export</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ExportFromClause">ExportFromClause</a></emu-nt>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FromClause">FromClause</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="j2lh_kda">
        <emu-t>export</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-NamedExports">NamedExports</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="rudz_osj">
        <emu-t>export</emu-t>
        <emu-nt params="~Yield, +Await"><a href="https://tc39.es/ecma262/#prod-VariableStatement">VariableStatement</a><emu-mods><emu-params>[~Yield, +Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="cshvsnoo">
        <emu-t>export</emu-t>
        <emu-nt params="~Yield, +Await"><a href="https://tc39.es/ecma262/#prod-Declaration">Declaration</a><emu-mods><emu-params>[~Yield, +Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="pkwjy2r6">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt params="~Yield, +Await, +Default"><a href="https://tc39.es/ecma262/#prod-HoistableDeclaration">HoistableDeclaration</a><emu-mods><emu-params>[~Yield, +Await, +Default]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="hf5nsghg">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt params="~Yield, +Await, +Default"><a href="https://tc39.es/ecma262/#prod-ClassDeclaration">ClassDeclaration</a><emu-mods><emu-params>[~Yield, +Await, +Default]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <ins><emu-rhs a="f-1gjiqg">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt params="~Yield, +Await, +Default" id="_ref_162"><a href="#prod-StructDeclaration">StructDeclaration</a><emu-mods><emu-params>[~Yield, +Await, +Default]</emu-params></emu-mods></emu-nt>
    </emu-rhs></ins>
    <emu-rhs a="33r7jf_e">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-gann>[lookahead ∉ { <emu-t>function</emu-t>, <emu-t>async</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-t>function</emu-t>, <emu-t>class</emu-t> }]</emu-gann>
        <emu-nt params="+In, ~Yield, +Await"><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a><emu-mods><emu-params>[+In, ~Yield, +Await]</emu-params></emu-mods></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>

    <emu-clause id="sec-exports-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">1.5.1</span> Runtime Semantics: Evaluation</h1>
      <ins class="block">
      <emu-grammar><emu-production name="ExportDeclaration" collapsed="">
    <emu-nt><a href="#prod-ExportDeclaration">ExportDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="i25bct0k">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt id="_ref_163"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="BindingStructDeclarationEvaluation" id="_ref_38"><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" class="e-user-code">BindingStructDeclarationEvaluation</a></emu-xref> of <emu-nt id="_ref_164"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Let <var>structName</var> be the sole element of the <emu-xref aoid="BoundNames"><a href="https://tc39.es/ecma262/#sec-static-semantics-boundnames">BoundNames</a></emu-xref> of <emu-nt id="_ref_165"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>If <var>structName</var> is <emu-val>"*default*"</emu-val>, then<ol><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeBoundName"><a href="https://tc39.es/ecma262/#sec-initializeboundname" class="e-user-code">InitializeBoundName</a></emu-xref>(<emu-val>"*default*"</emu-val>, <var>value</var>, <var>env</var>).</li></ol></li><li>Return <emu-const>empty</emu-const>.</li></ol></emu-alg>
      </ins>
    </emu-clause>
  </emu-clause>
</emu-clause>

<emu-clause id="sec-shared-structs">
  <h1><span class="secnum">2</span> Shared Structs</h1>

  <emu-clause id="sec-shared-struct-exotic-objects">
    <h1><span class="secnum">2.1</span> Shared Struct Exotic Objects</h1>
    <ins class="block">
    <p><emu-xref href="#shared-struct-exotic-object" id="_ref_39"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> are fixed-layout <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic objects</a></emu-xref> that can be shared across <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref> and be accessed in parallel from multiple <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>. They are like structs with more restricted behaviour so as to be possible to be shared across <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>. They cannot contain methods or private fields. Their fields can only hold primitives or other shared values. Accessing their fields is unordered by default and is governed by the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref>. Such accesses can be made sequentially consistent by using newly overloaded Atomics methods.</p>
    <p>An object is a <dfn id="shared-struct-exotic-object" variants="Shared Structs">Shared Struct</dfn> if its [[GetOwnProperty]], [[DefineOwnProperty]], [[HasProperty]], [[Get]], [[Set]], and [[Delete]] internal methods use the definitions in this section, and its other essential internal methods use the definitions found in <emu-xref href="#sec-ordinary-object-internal-methods-and-internal-slots"><a href="https://tc39.es/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots">10.1</a></emu-xref>.</p>

    <emu-clause id="sec-fictional-criticalsection">
      <h1><span class="secnum">2.1.1</span> Critical Section for Shared Struct Creation</h1>

      <emu-clause id="sec-entersharedstructcreationcriticalsection" type="abstract operation" aoid="EnterSharedStructCreationCriticalSection">
        <h1><span class="secnum">2.1.1.1</span> EnterSharedStructCreationCriticalSection ( )</h1>
        <p>The abstract operation EnterSharedStructCreationCriticalSection takes no arguments and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
        <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: The <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> is not in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_40"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Wait until no <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agent</a></emu-xref> is in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_41"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation, then enter the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_42"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation (without allowing any other <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agent</a></emu-xref> to enter).</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-leavesharedstructcreationcriticalsection" type="abstract operation" aoid="LeaveSharedStructCreationCriticalSection">
        <h1><span class="secnum">2.1.1.2</span> LeaveSharedStructCreationCriticalSection ( )</h1>
        <p>The abstract operation LeaveSharedStructCreationCriticalSection takes no arguments and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
        <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: The <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> is in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_43"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Leave the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_44"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
      </emu-clause>

      <emu-note><span class="note">Note</span><div class="note-contents">
        <p>This <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> is a specification semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to prohibit the nondeterministic read in <emu-xref aoid="ReadSharedStructField" id="_ref_45"><a href="#sec-readsharedstructfield">ReadSharedStructField</a></emu-xref> from manifesting <emu-xref href="#shared-struct-exotic-object" id="_ref_46"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> values that are partially initialized.</p>
        <p>This <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> does not provide any ordering guarantees.</p>
        <p>In implementations, this <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> is not needed. Implementations must not allow out-of-thin-air reads.</p>
      </div></emu-note>
    </emu-clause>

    <emu-clause id="sec-readsharedstructfield" type="abstract operation" aoid="ReadSharedStructField">
      <h1><span class="secnum">2.1.2</span> ReadSharedStructField ( <var>struct</var>, <var>field</var>, <var>order</var> )</h1>
      <p>The abstract operation ReadSharedStructField takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_47"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), and <var>order</var> (<emu-const>seq-cst</emu-const> or <emu-const>unordered</emu-const>) and returns an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>execution</var> be the [[CandidateExecution]] field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.[[EventsRecords]] whose [[AgentSignifier]] is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_48"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { [[Struct]]: <var>struct</var>, [[Field]]: <var>field</var> }.</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_49"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>rawLanguageValue</var> be a nondeterministically chosen <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> such that <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_50"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>rawLanguageValue</var>) is <emu-val>true</emu-val>.</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_51"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li>NOTE: In implementations, <var>rawLanguageValue</var> is the result of a non-atomic or atomic read instruction on the underlying hardware. The nondeterminism is a semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to describe observable behaviour of hardware with weak consistency.</li><li>Let <var>readEvent</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_52"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> { [[Order]]: <var>order</var>, [[NoTear]]: <emu-val>true</emu-val>, [[Storage]]: <var>storage</var> } to <var>eventsRecord</var>.[[EventList]].</li><li>Append <var>readEvent</var> to <var>eventsRecord</var>.[[EventList]].</li><li>NOTE: Shared struct field accesses can never tear.</li><li>Append <emu-xref href="#sec-chosen-value-records"><a href="https://tc39.es/ecma262/#sec-chosen-value-records">Chosen Value Record</a></emu-xref> { [[Event]]: <var>readEvent</var>, [[ChosenValue]]: <var>rawLanguageValue</var> } to <var>execution</var>.[[ChosenValues]].</li><li>Return <var>rawLanguageValue</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-writesharedstructfield" type="abstract operation" aoid="WriteSharedStructField">
      <h1><span class="secnum">2.1.3</span> WriteSharedStructField ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>order</var> )</h1>
      <p>The abstract operation WriteSharedStructField takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_53"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>value</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>order</var> (<emu-const>seq-cst</emu-const>, <emu-const>unordered</emu-const>, or <emu-const>init</emu-const>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_54"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>value</var>) is <emu-val>true</emu-val>.</li><li>Let <var>execution</var> be the [[CandidateExecution]] field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.[[EventsRecords]] whose [[AgentSignifier]] is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_55"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { [[Struct]]: <var>struct</var>, [[Field]]: <var>field</var> }.</li><li>Append <emu-xref href="#sec-memory-model-fundamentals" id="_ref_56"><a href="#sec-memory-model-fundamentals">WriteSharedMemory</a></emu-xref> { [[Order]]: <var>order</var>, [[NoTear]]: <emu-val>true</emu-val>, [[Storage]]: <var>storage</var>, [[Payload]]: <var>value</var> } to <var>eventsRecord</var>.[[EventList]].</li><li>NOTE: Shared struct field accesses can never tear.</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-getownproperty" type="internal method">
      <h1><span class="secnum">2.1.4</span> [[GetOwnProperty]] ( <var>P</var> )</h1>
      <p>The [[GetOwnProperty]] internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_57"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes argument <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> either a <emu-xref href="#sec-property-descriptor-specification-type"><a href="https://tc39.es/ecma262/#sec-property-descriptor-specification-type">Property Descriptor</a></emu-xref> or <emu-val>undefined</emu-val>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>O</var> does not have an own property with key <var>P</var>, return <emu-val>undefined</emu-val>.</li><li>Let <var>D</var> be a newly created <emu-xref href="#sec-property-descriptor-specification-type"><a href="https://tc39.es/ecma262/#sec-property-descriptor-specification-type">Property Descriptor</a></emu-xref> with no fields.</li><li>Let <var>X</var> be <var>O</var>'s own property whose key is <var>P</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>X</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref>.</li><li>Set <var>D</var>.[[Value]] to <emu-xref aoid="ReadSharedStructField" id="_ref_58"><a href="#sec-readsharedstructfield">ReadSharedStructField</a></emu-xref>(<var>O</var>, <var>P</var>, <emu-const>unordered</emu-const>).</li><li>Set <var>D</var>.[[Writable]] to <emu-val>false</emu-val>.</li><li>Set <var>D</var>.[[Enumerable]] to <emu-val>true</emu-val>.</li><li>Set <var>D</var>.[[Configurable]] to <emu-val>false</emu-val>.</li><li>Return <var>D</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-defineownproperty" type="internal method">
      <h1><span class="secnum">2.1.5</span> [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var> )</h1>
      <p>The [[DefineOwnProperty]] internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_59"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and <var>Desc</var> (a <emu-xref href="#sec-property-descriptor-specification-type"><a href="https://tc39.es/ecma262/#sec-property-descriptor-specification-type">Property Descriptor</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="TestIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-testintegritylevel">TestIntegrityLevel</a></emu-xref>(<var>O</var>, <emu-const>sealed</emu-const>) is <emu-val>true</emu-val>.</li><li>Let <var>current</var> be !&nbsp;<var>O</var>.[[GetOwnProperty]](<var>P</var>).</li><li>If <var>current</var> is <emu-val>undefined</emu-val>, return <emu-val>false</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsDataDescriptor"><a href="https://tc39.es/ecma262/#sec-isdatadescriptor">IsDataDescriptor</a></emu-xref>(<var>current</var>) is <emu-val>true</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>current</var>.[[Enumerable]] is <emu-val>true</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>current</var>.[[Configurable]] is <emu-val>false</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>current</var>.[[Writable]] is <emu-val>true</emu-val>.</li><li>If <var>Desc</var> has a [[Enumerable]] field and <var>Desc</var>.[[Enumerable]] is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>Desc</var> has a [[Configurable]] field and <var>Desc</var>.[[Configurable]] is <emu-val>true</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>Desc</var> has a [[Writable]] field and <var>Desc</var>.[[Writable]] is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>Desc</var> has a [[Value]] field, then<ol><li>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_60"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>Desc</var>.[[Value]]) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_61"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>O</var>, <var>P</var>, <var>Desc</var>.[[Value]], <emu-const>unordered</emu-const>).</li></ol></li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-hasproperty" type="internal method">
      <h1><span class="secnum">2.1.6</span> [[HasProperty]] ( <var>P</var> )</h1>
      <p>The [[HasProperty]] internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_62"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes argument <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>O</var> does not have an own property with key <var>P</var>, return <emu-val>false</emu-val>.</li><li>NOTE: [[GetOwnPropertyDescriptor]] is not used to avoid an unnecessary <emu-xref href="#sec-memory-model-fundamentals" id="_ref_63"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> event.</li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-get" type="internal method">
      <h1><span class="secnum">2.1.7</span> [[Get]] ( <var>P</var>, <var>Receiver</var> )</h1>
      <p>The [[Get]] internal method of a shared Struct <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>ownDesc</var> be !&nbsp;<var>O</var>.[[GetOwnProperty]](<var>P</var>).</li><li>If <var>ownDesc</var> is <emu-val>undefined</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Return <var>ownDesc</var>.[[Value]].</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-set" type="internal method">
      <h1><span class="secnum">2.1.8</span> [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )</h1>
      <p>The [[Set]] internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_64"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>O</var> does not have an own property with key <var>P</var>, return <emu-val>false</emu-val>.</li><li>NOTE: [[GetOwnPropertyDescriptor]] is not used to avoid an unnecessary <emu-xref href="#sec-memory-model-fundamentals" id="_ref_65"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> event.</li><li>Let <var>desc</var> be PropertyDescriptor { [[Value]]: <var>V</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>true</emu-val>, [[Configurable]]: <emu-val>false</emu-val> }.</li><li>Return ?&nbsp;<var>O</var>.[[DefineOwnProperty]](<var>P</var>, <var>desc</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-delete" type="internal method">
      <h1><span class="secnum">2.1.9</span> [[Delete]] ( <var>P</var> )</h1>
      <p>The [[Delete]] internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_66"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes argument <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-val>false</emu-val>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="sec-shared-structs-syntax-and-eval">
    <h1><span class="secnum">2.2</span> Syntax</h1>

    <ins class="block">
    <emu-grammar type="definition"><emu-production name="StructDeclaration" params="Yield, Await, Default" id="prod-StructDeclaration">
    <emu-nt params="Yield, Await, Default"><a href="#prod-StructDeclaration">StructDeclaration</a><emu-mods><emu-params>[Yield, Await, Default]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="m8kl-wsa" id="prod-OXIfDnE4">
        <emu-t>shared</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
        <emu-nt params="?Yield, ?Await" id="_ref_166"><a href="#prod-SharedStructTail">SharedStructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="ctiyx4zt" constraints="+Default"><emu-constraints>[+Default]</emu-constraints>
        <emu-t>shared</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await" id="_ref_167"><a href="#prod-SharedStructTail">SharedStructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
<emu-production name="StructExpression" params="Yield, Await" id="prod-StructExpression">
    <emu-nt params="Yield, Await"><a href="#prod-StructExpression">StructExpression</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="quurdc33" id="prod-5r_d63Jv">
        <emu-t>shared</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await" optional=""><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-nt params="?Yield, ?Await" id="_ref_168"><a href="#prod-SharedStructTail">SharedStructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
<emu-production name="SharedStructTail" params="Yield, Await" id="prod-SharedStructTail">
    <emu-nt params="Yield, Await"><a href="#prod-SharedStructTail">SharedStructTail</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="gfsakt6f" id="prod-6RgYaWnz">
        <emu-nt params="?Yield, ?Await" optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt params="?Yield, ?Await" optional="" id="_ref_169"><a href="#prod-SharedStructBody">SharedStructBody</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
<emu-production name="SharedStructBody" params="Yield, Await" id="prod-SharedStructBody">
    <emu-nt params="Yield, Await"><a href="#prod-SharedStructBody">SharedStructBody</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="hi6rf-a8">
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
    <emu-note><span class="note">Note</span><div class="note-contents">
      <p>A shared struct definition is always <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.es/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>.</p>
    </div></emu-note>

    <emu-clause id="sec-struct-definitions-static-semantics-containsinstanceprivateidentifier" type="sdo" aoid="ContainsInstancePrivateIdentifier">
      <h1><span class="secnum">2.2.1</span> Static Semantics: ContainsInstancePrivateIdentifier</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> ContainsInstancePrivateIdentifier takes no arguments and returns a Boolean. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="crvluhmw"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_67"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="msulavvt">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>If <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_68"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>, return <emu-val>true</emu-val>.</li><li>Return <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_69"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="bwbyf1-5">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt> <emu-xref aoid="Contains"><a href="https://tc39.es/ecma262/#sec-static-semantics-contains">Contains</a></emu-xref> <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="s8ilfl9g"><emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt> <emu-xref aoid="Contains"><a href="https://tc39.es/ecma262/#sec-static-semantics-contains">Contains</a></emu-xref> <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="cpyv1xvc">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="-ljgtrpo">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="2ui-f2qn">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassStaticBlock">ClassStaticBlock</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="sg2sawim">
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-struct-definitions-static-semantics-containsinstancemethod" type="sdo" aoid="ContainsInstanceMethod">
      <h1><span class="secnum">2.2.2</span> Static Semantics: ContainsInstanceMethod</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> ContainsInstanceMethod takes no arguments and returns a Boolean. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="crvluhmw"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-xref aoid="ContainsInstanceMethod" id="_ref_70"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="msulavvt">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>If <emu-xref aoid="ContainsInstanceMethod" id="_ref_71"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>, return <emu-val>true</emu-val>.</li><li>Return <emu-xref aoid="ContainsInstanceMethod" id="_ref_72"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="s8ilfl9g"><emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>If <emu-xref aoid="ClassElementKind"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementkind">ClassElementKind</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> is <emu-const>constructor-method</emu-const>, return <emu-val>false</emu-val>.</li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="bwbyf1-5">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="cpyv1xvc">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="-ljgtrpo">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="2ui-f2qn">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassStaticBlock">ClassStaticBlock</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="sg2sawim">
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-definitions-static-semantics-early-errors">
      <h1><span class="secnum">2.2.3</span> Static Semantics: Early Errors</h1>
      <emu-grammar><emu-production name="SharedStructBody" collapsed="">
    <emu-nt><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="1y1dunax"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <ul>
        <li>
          It is a SyntaxError if <emu-xref aoid="PrototypePropertyNameList"><a href="https://tc39.es/ecma262/#sec-static-semantics-prototypepropertynamelist">PrototypePropertyNameList</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> contains more than one occurrence of <emu-val>"constructor"</emu-val>.
        </li>
        <li>
          It is a Syntax Error if <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_73"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> is <emu-val>true</emu-val>.
        </li>
        <li>
          It is a SyntaxError if <emu-xref aoid="ContainsInstanceMethod" id="_ref_74"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> is <emu-val>true</emu-val>.
        </li>
      </ul>
      <emu-note><span class="note">Note</span><div class="note-contents">
        <p>EDITOR'S NOTE: Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will allow methods.</p>
      </div></emu-note>
    </emu-clause>

    <emu-clause id="sec-canbesharedacrossagents" type="abstract operation" aoid="CanBeSharedAcrossAgents">
      <h1><span class="secnum">2.2.4</span> CanBeSharedAcrossAgents ( <var>val</var> )</h1>
      <p>The abstract operation CanBeSharedAcrossAgents takes argument <var>val</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns a Boolean.</p>
          <p>Returns whether ECMAScript language language values can be shared across <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>. Primitives can always be shared.</p>
        
      <p>It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>val</var> is <emu-val>undefined</emu-val>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> is <emu-val>null</emu-val>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is a String</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-boolean-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-boolean-type">is a Boolean</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-number-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-number-type">is a Number</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-bigint-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-bigint-type">is a BigInt</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-symbol-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-symbol-type">is a Symbol</a></emu-xref>, return <emu-val>true</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>val</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is an Object</a></emu-xref>.</li><li>If <var>val</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_75"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic object</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-definesharedstructfield" type="abstract operation" aoid="DefineSharedStructField">
      <h1><span class="secnum">2.2.5</span> DefineSharedStructField ( <var>receiver</var>, <var>fieldRecord</var> )</h1>
      <p>The abstract operation DefineSharedStructField takes arguments <var>receiver</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_76"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>) and <var>fieldRecord</var> (a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: The <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> is in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_77"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Let <var>fieldName</var> be <var>fieldRecord</var>.[[Name]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>fieldName</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>.</li><li>Create an own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> named <var>fieldName</var> of object <var>receiver</var> whose [[Value]] is <emu-val>undefined</emu-val>, [[Writable]] is <emu-val>true</emu-val>, [[Enumerable]] is <emu-val>true</emu-val>, and [[Configurable]] is <emu-val>false</emu-val>.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_78"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, <emu-val>undefined</emu-val>, <emu-const>init</emu-const>).</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-sharedstructdefinitionevaluation" type="sdo" aoid="SharedStructDefinitionEvaluation">
      <h1><span class="secnum">2.2.6</span> Runtime Semantics: SharedStructDefinitionEvaluation</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> SharedStructDefinitionEvaluation takes arguments <var>structBinding</var> (a String or <emu-val>undefined</emu-val>) and <var>structName</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="SharedStructTail" collapsed="">
    <emu-nt><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="rfhztyzb" id="prod-BhzXWGRY">
        <emu-nt optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt optional="" id="_ref_170"><a href="#prod-SharedStructBody">SharedStructBody</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>env</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>structEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment"><a href="https://tc39.es/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>env</var>).</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.CreateImmutableBinding(<var>structBinding</var>, <emu-val>true</emu-val>).</li></ol></li><li>Let <var>outerPrivateEnvironment</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment.</li><li>Let <var>classPrivateEnvironment</var> be <emu-xref aoid="NewPrivateEnvironment"><a href="https://tc39.es/ecma262/#sec-newprivateenvironment">NewPrivateEnvironment</a></emu-xref>(<var>outerPrivateEnvironment</var>).</li><li>If <emu-nt id="_ref_171"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt> is present, then<ol><li>For each String <var>dn</var> of the <emu-xref aoid="PrivateBoundIdentifiers"><a href="https://tc39.es/ecma262/#sec-static-semantics-privateboundidentifiers">PrivateBoundIdentifiers</a></emu-xref> of <emu-nt id="_ref_172"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt>, do<ol><li>If <var>classPrivateEnvironment</var>.[[Names]] contains a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> <var>pn</var> such that <var>pn</var>.[[Description]] is <var>dn</var>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: This is only possible for getter/setter pairs.</li></ol></li><li>Else,<ol><li>Let <var>name</var> be a new <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> whose [[Description]] is <var>dn</var>.</li><li>Append <var>name</var> to <var>classPrivateEnvironment</var>.[[Names]].</li></ol></li></ol></li></ol></li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is not present, then<ol><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else,<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>Let <var>superclassRef</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt>).</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Let <var>superclass</var> be ?&nbsp;<emu-xref aoid="GetValue"><a href="https://tc39.es/ecma262/#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(? <var>superclassRef</var>).</li><li>If <var>superclass</var> is <emu-val>null</emu-val>, then<ol><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else if <var>superclass</var> does not have a [[IsSharedStructConstructor]] internal slot, then<ol><li>Throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>Else,<ol><li>Let <var>constructorParent</var> be <var>superclass</var>.</li></ol></li></ol></li><li>Let <var>proto</var> be <emu-val>null</emu-val>.</li><li>NOTE: Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will allow prototypes.</li><li>NOTE: <emu-xref href="#shared-struct-exotic-object" id="_ref_79"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> have one-shot construction, with the user-defined "<emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>" method performing post-construction initialization. By the time ECMAScript code has access to a <emu-xref href="#shared-struct-exotic-object" id="_ref_80"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> instance, it already has all of its declared fields as own properties.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>classPrivateEnvironment</var>.</li><li>If <emu-nt id="_ref_173"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt> is not present, let <var>initializerParseNode</var> be <emu-const>empty</emu-const>.</li><li>Else, let <var>initializerParseNode</var> be <emu-xref aoid="ConstructorMethod"><a href="https://tc39.es/ecma262/#sec-static-semantics-constructormethod">ConstructorMethod</a></emu-xref> of <emu-nt id="_ref_174"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt>.</li><li>If <var>initializerParseNode</var> is <emu-const>empty</emu-const>, then<ol><li>Let <var>initializer</var> be <emu-const>empty</emu-const>.</li></ol></li><li>Else,<ol><li>Let <var>initializerInfo</var> be ?&nbsp;<emu-xref aoid="DefineMethod" id="_ref_81"><a href="#sec-runtime-semantics-definemethod" class="e-user-code">DefineMethod</a></emu-xref> of <var>initializerParseNode</var> with arguments <var>proto</var> and <var>constructorParent</var>.</li><li>Let <var>initializer</var> be <var>initializerInfo</var>.[[Closure]].</li><li>Perform <emu-xref aoid="SetFunctionName"><a href="https://tc39.es/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>initializer</var>, <var>structName</var>).</li></ol></li><li>Let <var>constructor</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>initializer</var> and performs the following steps when called:<ol><li>Let <var>args</var> be the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of arguments that was passed to this function by [[Call]] or [[Construct]].</li><li>Let <var>F</var> be the <emu-xref href="#active-function-object"><a href="https://tc39.es/ecma262/#active-function-object">active function object</a></emu-xref>.</li><li>If NewTarget is not <var>F</var>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_82"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>result</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-val>null</emu-val>, « »).</li><li>Set <var>result</var>.[[GetOwnProperty]] as specified in <emu-xref href="#sec-shared-struct-getownproperty" id="_ref_3"><a href="#sec-shared-struct-getownproperty">2.1.4</a></emu-xref>.</li><li>Set <var>result</var>.[[DefineOwnProperty]] as specified in <emu-xref href="#sec-shared-struct-defineownproperty" id="_ref_4"><a href="#sec-shared-struct-defineownproperty">2.1.5</a></emu-xref>.</li><li>Set <var>result</var>.[[HasProperty]] as specified in <emu-xref href="#sec-shared-struct-hasproperty" id="_ref_5"><a href="#sec-shared-struct-hasproperty">2.1.6</a></emu-xref>.</li><li>Set <var>result</var>.[[Get]] as specified in <emu-xref href="#sec-shared-struct-get" id="_ref_6"><a href="#sec-shared-struct-get">2.1.7</a></emu-xref>.</li><li>Set <var>result</var>.[[Set]] as specified in <emu-xref href="#sec-shared-struct-set" id="_ref_7"><a href="#sec-shared-struct-set">2.1.8</a></emu-xref>.</li><li>Set <var>result</var>.[[Delete]] as specified in <emu-xref href="#sec-shared-struct-delete" id="_ref_8"><a href="#sec-shared-struct-delete">2.1.9</a></emu-xref>.</li><li>Perform <emu-xref aoid="InitializeStructInstanceFieldsAndBrand" id="_ref_83"><a href="#sec-initializestructinstancefieldsandbrands">InitializeStructInstanceFieldsAndBrand</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>Perform !&nbsp;<var>result</var>.[[PreventExtensions]]().</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_84"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="TestIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-testintegritylevel">TestIntegrityLevel</a></emu-xref>(<var>result</var>, <emu-const>sealed</emu-const>) is <emu-val>true</emu-val>.</li><li>Perform ?&nbsp;<emu-xref aoid="RunStructInstanceFieldInitializers" id="_ref_85"><a href="#sec-runstructinstancefieldinitializers" class="e-user-code">RunStructInstanceFieldInitializers</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>If <var>initializer</var> is not <emu-const>empty</emu-const>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>initializer</var>, <var>result</var>).</li></ol></li><li>Return <var>result</var>.</li></ol></li><li>Let <var>F</var> be <emu-xref aoid="CreateBuiltinFunction"><a href="https://tc39.es/ecma262/#sec-createbuiltinfunction">CreateBuiltinFunction</a></emu-xref>(<var>constructor</var>, 0, structName, « [[ConstructorKind]], [[SourceText]], [[StructInitializer]], [[IsSharedStructConstructor]] », <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>, <var>constructorParent</var>).</li><li>Perform <emu-xref aoid="MakeConstructor"><a href="https://tc39.es/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>F</var>, <emu-val>false</emu-val>, <var>proto</var>).</li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is present, set <var>F</var>.[[ConstructorKind]] to <emu-const>derived</emu-const>.</li><li>Set <var>F</var>.[[StructInitializer]] to <var>initializer</var>.</li><li>Set <var>F</var>.[[IsSharedStructConstructor]] to <emu-val>true</emu-val>.</li><li>If <emu-nt id="_ref_175"><a href="#prod-StructBody">StructBody</a></emu-nt> is not present, let <var>elements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Else, let <var>elements</var> be <emu-xref aoid="NonConstructorElements"><a href="https://tc39.es/ecma262/#sec-static-semantics-nonconstructorelements">NonConstructorElements</a></emu-xref> of <emu-nt id="_ref_176"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt>.</li><li>Let <var>staticPrivateMethods</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>instanceFields</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>staticElements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>For each <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <var>e</var> of <var>elements</var>, do<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, then<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>proto</var>).</li></ol></li><li>Else,<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>F</var>).</li></ol></li><li>If <var>element</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>element</var>.</li></ol></li><li>Set <var>element</var> to !&nbsp;<var>element</var>.</li><li>If <var>element</var> is a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.[[Kind]] is either <emu-const>method</emu-const> or <emu-const>accessor</emu-const>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>true</emu-val>.</li><li>Let <var>container</var> be <var>staticPrivateMethods</var>.</li><li>If <var>container</var> contains a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>pe</var> such that <var>pe</var>.[[Key]] is <var>element</var>.[[Key]], then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.[[Kind]] and <var>pe</var>.[[Kind]] are both <emu-const>accessor</emu-const>.</li><li>If <var>element</var>.[[Get]] is <emu-val>undefined</emu-val>, then<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { [[Key]]: <var>element</var>.[[Key]], [[Kind]]: <emu-const>accessor</emu-const>, [[Get]]: <var>pe</var>.[[Get]], [[Set]]: <var>element</var>.[[Set]] }.</li></ol></li><li>Else,<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { [[Key]]: <var>element</var>.[[Key]], [[Kind]]: <emu-const>accessor</emu-const>, [[Get]]: <var>element</var>.[[Get]], [[Set]]: <var>pe</var>.[[Set]] }.</li></ol></li><li>Replace <var>pe</var> in <var>container</var> with <var>combined</var>.</li></ol></li><li>Else,<ol><li>Append <var>element</var> to <var>container</var>.</li></ol></li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, append <var>element</var> to <var>instanceFields</var>.</li><li>Else, append <var>element</var> to <var>staticElements</var>.</li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>, then<ol><li>Append <var>element</var> to <var>staticElements</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.InitializeBinding(<var>structBinding</var>, <var>F</var>).</li></ol></li><li>Set <var>F</var>.[[Fields]] to <var>instanceFields</var>.</li><li>For each <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>method</var> of <var>staticPrivateMethods</var>, do<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateMethodOrAccessorAdd"><a href="https://tc39.es/ecma262/#sec-privatemethodoraccessoradd">PrivateMethodOrAccessorAdd</a></emu-xref>(<var>F</var>, <var>method</var>).</li></ol></li><li>For each element <var>elementRecord</var> of <var>staticElements</var>, do<ol><li>If <var>elementRecord</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="DefineField"><a href="https://tc39.es/ecma262/#sec-definefield" class="e-user-code">DefineField</a></emu-xref>(<var>F</var>, <var>elementRecord</var>)).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>elementRecord</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>.</li><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>elementRecord</var>.[[BodyFunction]], <var>F</var>)).</li></ol></li><li>If <var>result</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>result</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Perform !&nbsp;<emu-xref aoid="SetIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-setintegritylevel">SetIntegrityLevel</a></emu-xref>(<var>F</var>, <emu-const>sealed</emu-const>).</li><li>Return <var>F</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-bindingsharedstructdeclarationevaluation" type="" sdo"="">
      <h1><span class="secnum">2.2.7</span> Runtime Semantics: BindingStructDeclarationEvaluation</h1>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oovofrol">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_177"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>structName</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="SharedStructDefinitionEvaluation" id="_ref_86"><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" class="e-user-code">SharedStructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_178"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <var>structName</var> and <var>structName</var>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_179"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeBoundName"><a href="https://tc39.es/ecma262/#sec-initializeboundname" class="e-user-code">InitializeBoundName</a></emu-xref>(<var>structName</var>, <var>value</var>, <var>env</var>).</li><li>Return <var>value</var>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oczmzkvc">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt id="_ref_180"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="SharedStructDefinitionEvaluation" id="_ref_87"><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" class="e-user-code">SharedStructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_181"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt> with arguments <emu-val>undefined</emu-val> and <emu-val>"default"</emu-val>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_182"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-definitions-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">2.2.8</span> Runtime Semantics: Evaluation</h1>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oovofrol" id="prod-a7FVdFNf">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_183"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="BindingStructDeclarationEvaluation" id="_ref_88"><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" class="e-user-code">BindingStructDeclarationEvaluation</a></emu-xref> of this <emu-nt id="_ref_184"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <emu-const>empty</emu-const>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructExpression" collapsed="">
    <emu-nt><a href="#prod-StructExpression">StructExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oczmzkvc" id="prod-hQkzKJ35">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt id="_ref_185"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="SharedStructDefinitionEvaluation" id="_ref_89"><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" class="e-user-code">SharedStructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_186"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt> with arguments <emu-val>undefined</emu-val> and <emu-val>""</emu-val>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_187"><a href="#prod-StructExpression">StructExpression</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructExpression" collapsed="">
    <emu-nt><a href="#prod-StructExpression">StructExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oovofrol" id="prod-DuGDGqHy">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_188"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>structName</var> be <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="SharedStructDefinitionEvaluation" id="_ref_90"><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" class="e-user-code">SharedStructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_189"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt> with arguments <var>structName</var> and <var>structName</var>.</li><li>Set <var>value</var>.[[SourceText]] to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_190"><a href="#prod-StructExpression">StructExpression</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="sec-changes-to-atomics-object">
    <h1><span class="secnum">2.3</span> Changes to the Atomics Object</h1>

    <ins class="block">
    <emu-clause id="sec-atomiccompareexchangeinsharedstruct" type="abstract operation" aoid="AtomicCompareExchangeInSharedStruct">
      <h1><span class="secnum">2.3.1</span> AtomicCompareExchangeInSharedStruct ( <var>struct</var>, <var>field</var>, <var>expectedValue</var>, <var>replacementValue</var> )</h1>
      <p>The abstract operation AtomicCompareExchangeInSharedStruct takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_91"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>expectedValue</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>replacementValue</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_92"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>replacementValue</var>) is <emu-val>true</emu-val>.</li><li>Let <var>execution</var> be the [[CandidateExecution]] field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.[[EventsRecords]] whose [[AgentSignifier]] is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_93"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>rawLanguageValue</var> be a nondeterministically chosen <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> such that <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_94"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>rawLanguageValue</var>) is <emu-val>true</emu-val>.</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_95"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li>NOTE: In implementations, <var>rawLanguageValue</var> is the result of a non-atomic or atomic read instruction on the underlying hardware. The nondeterminism is a semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to describe observable behaviour of hardware with weak consistency.</li><li>NOTE: The comparison of the expected value and the read value is performed outside of the <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref> to avoid needlessly strong synchronization when the expected value is not equal to the read value.</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_96"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { [[Struct]]: <var>struct</var>, [[Field]]: <var>field</var> }.</li><li>If <emu-xref aoid="SameValue"><a href="https://tc39.es/ecma262/#sec-samevalue">SameValue</a></emu-xref>(<var>expectedValue</var>, <var>replacementValue</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>second</var> be a new <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref> with parameters (<var>oldValue</var>, <var>newValue</var>) that captures nothing and performs the following steps atomically when called:<ol><li>Return <var>newValue</var>.</li></ol></li><li>Let <var>event</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_97"><a href="#sec-memory-model-fundamentals">ReadModifyWriteSharedMemory</a></emu-xref> { [[Order]]: <emu-const>seq-cst</emu-const>, [[NoTear]]: <emu-val>true</emu-val>, [[Storage]]: <var>storage</var>, [[Payload]]: <var>replacementValue</var>, [[ModifyOp]]: <var>second</var> }.</li></ol></li><li>Else,<ol><li>Let <var>event</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_98"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> { [[Order]]: <emu-const>seq-cst</emu-const>, [[NoTear]]: <emu-val>true</emu-val>, [[Storage]]: <var>storage</var> }.</li></ol></li><li>Append <var>event</var> to <var>eventsRecord</var>.[[EventList]].</li><li>Append <emu-xref href="#sec-chosen-value-records"><a href="https://tc39.es/ecma262/#sec-chosen-value-records">Chosen Value Record</a></emu-xref> { [[Event]]: <var>event</var>, [[ChosenValue]]: <var>rawLanguageValue</var> } to <var>execution</var>.[[ChosenValues]].</li><li>Return <var>rawLanguageValue</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomicreadmodifywriteinsharedstruct" type="abstract operation" aoid="AtomicReadModifyWriteInSharedStruct">
      <h1><span class="secnum">2.3.2</span> AtomicReadModifyWriteInSharedStruct ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>op</var> )</h1>
      <p>The abstract operation AtomicReadModifyWriteInSharedStruct takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_99"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>value</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>op</var> (a <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>, or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>field</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_100"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>value</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>struct</var> does not have an own property with key <var>field</var>, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>execution</var> be the [[CandidateExecution]] field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.[[EventsRecords]] whose [[AgentSignifier]] is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_101"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>rawLanguageValue</var> be a nondeterministically chosen <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> such that <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_102"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>rawLanguageValue</var>) is <emu-val>true</emu-val>.</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_103"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li>NOTE: In implementations, <var>rawLanguageValue</var> is the result of a non-atomic or atomic read instruction on the underlying hardware. The nondeterminism is a semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to describe observable behaviour of hardware with weak consistency.</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_104"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { [[Struct]]: <var>struct</var>, [[Field]]: <var>field</var> }.</li><li>Let <var>rmwEvent</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_105"><a href="#sec-memory-model-fundamentals">ReadModifyWriteSharedMemory</a></emu-xref> { [[Order]]: <emu-const>seq-cst</emu-const>, [[NoTear]]: <emu-val>true</emu-val>, [[Storage]]: <var>storage</var>, [[Payload]]: <var>rawLanguageValue</var>, [[ModifyOp]]: <var>op</var> }.</li><li>Append <var>rmwEvent</var> to <var>eventsRecord</var>.[[EventList]].</li><li>Append <emu-xref href="#sec-chosen-value-records"><a href="https://tc39.es/ecma262/#sec-chosen-value-records">Chosen Value Record</a></emu-xref> { [[Event]]: <var>rmwEvent</var>, [[ChosenValue]]: <var>rawLanguageValue</var> } to <var>execution</var>.[[ChosenValues]].</li><li>Return <var>rawLanguageValue</var>.</li></ol></emu-alg>
    </emu-clause>
    </ins>

    <emu-clause id="sec-atomics.compareexchange-struct">
      <h1><span class="secnum">2.3.3</span> Atomics.compareExchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>expectedValue</var>, <var>replacementValue</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li><ins>If <var>typedArrayOrStruct</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_106"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>If <var>indexOrField</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_107"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>replacementValue</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <var>typedArrayOrStruct</var> does not have an own property with key <var>indexOrField</var>, throw a <emu-val>RangeError</emu-val> exception.</ins></li><li><ins>Return <emu-xref aoid="AtomicCompareExchangeInSharedStruct" id="_ref_108"><a href="#sec-atomiccompareexchangeinsharedstruct">AtomicCompareExchangeInSharedStruct</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <var>expectedValue</var>, <var>replacementValue</var>).</ins></li></ol></li><li><ins>Let <var>typedArray</var> be <var>typedArrayOrStruct</var>.</ins></li><li><ins>Let <var>index</var> be <var>indexOrField</var>.</ins></li><li>Let <var>byteIndexInBuffer</var> be ?&nbsp;<emu-xref aoid="ValidateAtomicAccessOnIntegerTypedArray"><a href="https://tc39.es/ecma262/#sec-validateatomicaccessonintegertypedarray" class="e-user-code">ValidateAtomicAccessOnIntegerTypedArray</a></emu-xref>(<var>typedArray</var>, <var>index</var>).</li><li>Let <var>buffer</var> be <var>typedArray</var>.[[ViewedArrayBuffer]].</li><li>Let <var>block</var> be <var>buffer</var>.[[ArrayBufferData]].</li><li>If <var>typedArray</var>.[[ContentType]] is <emu-const>bigint</emu-const>, then<ol><li>Let <var>expected</var> be ?&nbsp;<emu-xref aoid="ToBigInt"><a href="https://tc39.es/ecma262/#sec-tobigint" class="e-user-code">ToBigInt</a></emu-xref>(<var>expectedValue</var>).</li><li>Let <var>replacement</var> be ?&nbsp;<emu-xref aoid="ToBigInt"><a href="https://tc39.es/ecma262/#sec-tobigint" class="e-user-code">ToBigInt</a></emu-xref>(<var>replacementValue</var>).</li></ol></li><li>Else,<ol><li>Let <var>expected</var> be <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(? <emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity" class="e-user-code">ToIntegerOrInfinity</a></emu-xref>(<var>expectedValue</var>)).</li><li>Let <var>replacement</var> be <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(? <emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity" class="e-user-code">ToIntegerOrInfinity</a></emu-xref>(<var>replacementValue</var>)).</li></ol></li><li>Perform ?&nbsp;<emu-xref aoid="RevalidateAtomicAccess"><a href="https://tc39.es/ecma262/#sec-revalidateatomicaccess">RevalidateAtomicAccess</a></emu-xref>(<var>typedArray</var>, <var>byteIndexInBuffer</var>).</li><li>Let <var>elementType</var> be <emu-xref aoid="TypedArrayElementType"><a href="https://tc39.es/ecma262/#sec-typedarrayelementtype">TypedArrayElementType</a></emu-xref>(<var>typedArray</var>).</li><li>Let <var>elementSize</var> be <emu-xref aoid="TypedArrayElementSize"><a href="https://tc39.es/ecma262/#sec-typedarrayelementsize">TypedArrayElementSize</a></emu-xref>(<var>typedArray</var>).</li><li>Let <var>isLittleEndian</var> be the value of the [[LittleEndian]] field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>expectedBytes</var> be <emu-xref aoid="NumericToRawBytes"><a href="https://tc39.es/ecma262/#sec-numerictorawbytes">NumericToRawBytes</a></emu-xref>(<var>elementType</var>, <var>expected</var>, <var>isLittleEndian</var>).</li><li>Let <var>replacementBytes</var> be <emu-xref aoid="NumericToRawBytes"><a href="https://tc39.es/ecma262/#sec-numerictorawbytes">NumericToRawBytes</a></emu-xref>(<var>elementType</var>, <var>replacement</var>, <var>isLittleEndian</var>).</li><li>If <emu-xref aoid="IsSharedArrayBuffer"><a href="https://tc39.es/ecma262/#sec-issharedarraybuffer">IsSharedArrayBuffer</a></emu-xref>(<var>buffer</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>rawBytesRead</var> be <emu-xref aoid="AtomicCompareExchangeInSharedBlock"><a href="https://tc39.es/ecma262/#sec-atomiccompareexchangeinsharedblock">AtomicCompareExchangeInSharedBlock</a></emu-xref>(<var>block</var>, <var>byteIndexInBuffer</var>, <var>elementSize</var>, <var>expectedBytes</var>, <var>replacementBytes</var>).</li></ol></li><li>Else,<ol><li>Let <var>rawBytesRead</var> be a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of length <var>elementSize</var> whose elements are the sequence of <var>elementSize</var> bytes starting with <var>block</var>[<var>byteIndexInBuffer</var>].</li><li>If <emu-xref aoid="ByteListEqual"><a href="https://tc39.es/ecma262/#sec-bytelistequal">ByteListEqual</a></emu-xref>(<var>rawBytesRead</var>, <var>expectedBytes</var>) is <emu-val>true</emu-val>, then<ol><li>Store the individual bytes of <var>replacementBytes</var> into <var>block</var>, starting at <var>block</var>[<var>byteIndexInBuffer</var>].</li></ol></li></ol></li><li>Return <emu-xref aoid="RawBytesToNumeric"><a href="https://tc39.es/ecma262/#sec-rawbytestonumeric">RawBytesToNumeric</a></emu-xref>(<var>elementType</var>, <var>rawBytesRead</var>, <var>isLittleEndian</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.exchange-struct">
      <h1><span class="secnum">2.3.4</span> Atomics.exchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>second</var> be a new <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref> with parameters (<del><var>oldBytes</var></del><ins><var>oldValue</var></ins>, <del><var>newBytes</var></del><ins><var>newValue</var></ins>) that captures nothing and performs the following steps atomically when called:<ol><li>Return <del><var>newBytes</var></del><ins><var>newValue</var></ins>.</li></ol></li><li><ins>If _typedArrayOrStruct is a <emu-xref href="#shared-struct-exotic-object" id="_ref_109"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>Return ?&nbsp;<emu-xref aoid="AtomicReadModifyWriteInSharedStruct" id="_ref_110"><a href="#sec-atomicreadmodifywriteinsharedstruct">AtomicReadModifyWriteInSharedStruct</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <var>value</var>, <var>second</var>).</ins></li></ol></li><li><ins>Let <var>typedArray</var> be <var>typedArrayOrStruct</var>.</ins></li><li><ins>Let <var>index</var> be <var>indexOrField</var>.</ins></li><li>Return ?&nbsp;<emu-xref aoid="AtomicReadModifyWrite"><a href="https://tc39.es/ecma262/#sec-atomicreadmodifywrite" class="e-user-code">AtomicReadModifyWrite</a></emu-xref>(<var>typedArray</var>, <var>index</var>, <var>value</var>, <var>second</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.load-struct">
      <h1><span class="secnum">2.3.5</span> Atomics.load ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li><ins>If <var>typedArrayOrStruct</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_111"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>If <var>indexOrField</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <var>typedArrayOrStruct</var> does not have an own property with key <var>indexOrField</var>, throw a <emu-val>RangeError</emu-val> exception.</ins></li><li><ins>Return <emu-xref aoid="ReadSharedStructField" id="_ref_112"><a href="#sec-readsharedstructfield">ReadSharedStructField</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <emu-const>seq-cst</emu-const>).</ins></li></ol></li><li>Let <var>byteIndexInBuffer</var> be ?&nbsp;<emu-xref aoid="ValidateAtomicAccessOnIntegerTypedArray"><a href="https://tc39.es/ecma262/#sec-validateatomicaccessonintegertypedarray" class="e-user-code">ValidateAtomicAccessOnIntegerTypedArray</a></emu-xref>(<var>typedArray</var>, <var>index</var>).</li><li>Perform ?&nbsp;<emu-xref aoid="RevalidateAtomicAccess"><a href="https://tc39.es/ecma262/#sec-revalidateatomicaccess">RevalidateAtomicAccess</a></emu-xref>(<var>typedArray</var>, <var>byteIndexInBuffer</var>).</li><li>Let <var>buffer</var> be <var>typedArray</var>.[[ViewedArrayBuffer]].</li><li>Let <var>elementType</var> be <emu-xref aoid="TypedArrayElementType"><a href="https://tc39.es/ecma262/#sec-typedarrayelementtype">TypedArrayElementType</a></emu-xref>(<var>typedArray</var>).</li><li>Return <emu-xref aoid="GetValueFromBuffer"><a href="https://tc39.es/ecma262/#sec-getvaluefrombuffer">GetValueFromBuffer</a></emu-xref>(<var>buffer</var>, <var>byteIndexInBuffer</var>, <var>elementType</var>, <emu-val>true</emu-val>, <emu-const>seq-cst</emu-const>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.store-struct">
      <h1><span class="secnum">2.3.6</span> Atomics.store ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li><ins>If <var>typedArrayOrStruct</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_113"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>If <var>indexOrField</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_114"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>value</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <var>typedArrayOrStruct</var> does not have an own property with key <var>indexOrField</var>, throw a <emu-val>RangeError</emu-val> exception.</ins></li><li><ins>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_115"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <var>value</var>, <emu-const>seq-cst</emu-const>).</ins></li><li><ins>Return <var>value</var>.</ins></li></ol></li><li>Let <var>byteIndexInBuffer</var> be ?&nbsp;<emu-xref aoid="ValidateAtomicAccessOnIntegerTypedArray"><a href="https://tc39.es/ecma262/#sec-validateatomicaccessonintegertypedarray" class="e-user-code">ValidateAtomicAccessOnIntegerTypedArray</a></emu-xref>(<var>typedArray</var>, <var>index</var>).</li><li>If <var>typedArray</var>.[[ContentType]] is <emu-const>bigint</emu-const>, let <var>v</var> be ?&nbsp;<emu-xref aoid="ToBigInt"><a href="https://tc39.es/ecma262/#sec-tobigint" class="e-user-code">ToBigInt</a></emu-xref>(<var>value</var>).</li><li>Otherwise, let <var>v</var> be <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(? <emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity" class="e-user-code">ToIntegerOrInfinity</a></emu-xref>(<var>value</var>)).</li><li>Perform ?&nbsp;<emu-xref aoid="RevalidateAtomicAccess"><a href="https://tc39.es/ecma262/#sec-revalidateatomicaccess">RevalidateAtomicAccess</a></emu-xref>(<var>typedArray</var>, <var>byteIndexInBuffer</var>).</li><li>Let <var>buffer</var> be <var>typedArray</var>.[[ViewedArrayBuffer]].</li><li>Let <var>elementType</var> be <emu-xref aoid="TypedArrayElementType"><a href="https://tc39.es/ecma262/#sec-typedarrayelementtype">TypedArrayElementType</a></emu-xref>(<var>typedArray</var>).</li><li>Perform <emu-xref aoid="SetValueInBuffer"><a href="https://tc39.es/ecma262/#sec-setvalueinbuffer">SetValueInBuffer</a></emu-xref>(<var>buffer</var>, <var>byteIndexInBuffer</var>, <var>elementType</var>, <var>v</var>, <emu-val>true</emu-val>, <emu-const>seq-cst</emu-const>).</li><li>Return <var>v</var>.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-changes-to-memory-model">
    <h1><span class="secnum">2.4</span> Changes to the Memory Model</h1>
    <emu-clause id="sec-memory-model-fundamentals">
      <h1><span class="secnum">2.4.1</span> Memory Model Fundamentals</h1>
      <p>Shared memory accesses (reads and writes) are divided into two groups, atomic accesses and data accesses, defined below. Atomic accesses are sequentially consistent, i.e., there is a strict total ordering of events agreed upon by all <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref> in an <emu-xref href="#sec-agent-clusters"><a href="https://tc39.es/ecma262/#sec-agent-clusters">agent cluster</a></emu-xref>. Non-atomic accesses do not have a strict total ordering agreed upon by all <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>, i.e., unordered.</p>
      <emu-note><span class="note">Note</span><div class="note-contents">
        <p>No orderings weaker than sequentially consistent and stronger than unordered, such as release-acquire, are supported.</p>
      </div></emu-note>
      <ins class="block">
      <p>A <dfn variants="Shared Memory Storage Records">Shared Memory Storage Record</dfn> is either a <dfn>SharedBlockStorage</dfn> or <dfn>SharedStructStorage</dfn> <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref>.</p>

      <emu-table id="table-sharedblockstorage-fields" caption="SharedBlockStorage Fields"><figure><figcaption>Table 2: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_116"><a href="#sec-memory-model-fundamentals">SharedBlockStorage</a></emu-xref> Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
            <tr>
              <td>[[Block]]</td>
              <td>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></td>
              <td>The block the event operates on.</td>
            </tr>
            <tr>
              <td>[[ByteIndex]]</td>
              <td>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></td>
              <td>The byte address of the access in [[Block]].</td>
            </tr>
            <tr>
              <td>[[ElementSize]]</td>
              <td>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></td>
              <td>The size of the access.</td>
            </tr>
          </thead>
        </table>
      </figure></emu-table>

      <emu-table id="table-sharedstructstorage-fields" caption="SharedStructStorage Fields"><figure><figcaption>Table 3: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_117"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
            <tr>
              <td>[[Struct]]</td>
              <td>a <emu-xref href="#shared-struct-exotic-object" id="_ref_118"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref></td>
              <td>The shared struct the event operates on.</td>
            </tr>
            <tr>
              <td>[[Field]]</td>
              <td>a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref></td>
              <td>The field that is accessed in [[Struct]].</td>
            </tr>
          </thead>
        </table>
      </figure></emu-table>
      </ins>

      <p>A <dfn variants="Shared Data Block events">Shared Data Block event</dfn> is either a <dfn>ReadSharedMemory</dfn>, <dfn>WriteSharedMemory</dfn>, or <dfn>ReadModifyWriteSharedMemory</dfn> <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref>.</p>

      <emu-table id="table-readsharedmemory-fields" caption="ReadSharedMemory Event Fields"><figure><figcaption>Table 4: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_119"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> Event Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody><tr>
            <td>[[Order]]</td>
            <td><emu-const>seq-cst</emu-const> or <emu-const>unordered</emu-const></td>
            <td>The weakest ordering guaranteed by the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> for the event.</td>
          </tr>
          <tr>
            <td>[[NoTear]]</td>
            <td>a Boolean</td>
            <td>Whether this event is allowed to read from multiple write events with equal range as this event.</td>
          </tr>
          <tr>
            <td><del>[[Block]]</del></td>
            <td><del>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></del></td>
            <td><del>The block the event operates on.</del></td>
          </tr>
          <tr>
            <td><del>[[ByteIndex]]</del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The byte address of the read in [[Block]].</del></td>
          </tr>
          <tr>
            <td><del>[[ElementSize]]</del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The size of the read.</del></td>
          </tr>
          <tr>
            <td><ins>[[Storage]]</ins></td>
            <td><ins>a <emu-xref href="#sec-memory-model-fundamentals" id="_ref_120"><a href="#sec-memory-model-fundamentals">Shared Memory Storage Record</a></emu-xref></ins></td>
            <td><ins>The storage of memory that is read.</ins></td>
          </tr>
        </tbody></table>
      </figure></emu-table>

      <emu-table id="table-writesharedmemory-fields" caption="WriteSharedMemory Event Fields"><figure><figcaption>Table 5: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_121"><a href="#sec-memory-model-fundamentals">WriteSharedMemory</a></emu-xref> Event Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody><tr>
            <td>[[Order]]</td>
            <td><emu-const>seq-cst</emu-const>, <emu-const>unordered</emu-const>, or <emu-const>init</emu-const></td>
            <td>The weakest ordering guaranteed by the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> for the event.</td>
          </tr>
          <tr>
            <td>[[NoTear]]</td>
            <td>a Boolean</td>
            <td>Whether this event is allowed to be read from multiple read events with equal range as this event.</td>
          </tr>
          <tr>
            <td><del>[[Block]]</del></td>
            <td><del>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></del></td>
            <td><del>The block the event operates on.</del></td>
          </tr>
          <tr>
            <td><del>[[ByteIndex]]</del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The byte address of the write in [[Block]].</del></td>
          </tr>
          <tr>
            <td><del>[[ElementSize]]</del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The size of the write.</del></td>
          </tr>
          <tr>
            <td><ins>[[Storage]]</ins></td>
            <td><ins>a <emu-xref href="#sec-memory-model-fundamentals" id="_ref_122"><a href="#sec-memory-model-fundamentals">Shared Memory Storage Record</a></emu-xref></ins></td>
            <td><ins>The storage of memory that is written.</ins></td>
          </tr>
          <tr>
            <td>[[Payload]]</td>
            <td>a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref></td>
            <td>The <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> to be read by other events.</td>
          </tr>
        </tbody></table>
      </figure></emu-table>

      <emu-table id="table-rmwsharedmemory-fields" caption="ReadModifyWriteSharedMemory Event Fields"><figure><figcaption>Table 6: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_123"><a href="#sec-memory-model-fundamentals">ReadModifyWriteSharedMemory</a></emu-xref> Event Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody><tr>
            <td>[[Order]]</td>
            <td><emu-const>seq-cst</emu-const></td>
            <td>Read-modify-write events are always sequentially consistent.</td>
          </tr>
          <tr>
            <td>[[NoTear]]</td>
            <td><emu-val>true</emu-val></td>
            <td>Read-modify-write events cannot tear.</td>
          </tr>
          <tr>
            <td><del>[[Block]]</del></td>
            <td><del>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></del></td>
            <td><del>The block the event operates on.</del></td>
          </tr>
          <tr>
            <td><del>[[ByteIndex]]</del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The byte address of the read-modify-write in [[Block]].</del></td>
          </tr>
          <tr>
            <td><del>[[ElementSize]]</del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The size of the read-modify-write.</del></td>
          </tr>
          <tr>
            <td><ins>[[Storage]]</ins></td>
            <td><ins>a <emu-xref href="#sec-memory-model-fundamentals" id="_ref_124"><a href="#sec-memory-model-fundamentals">Shared Memory Storage Record</a></emu-xref></ins></td>
            <td><ins>The storage of memory of the read-modify-write.</ins></td>
          </tr>
          <tr>
            <td>[[Payload]]</td>
            <td>a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref></td>
            <td>The <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> to be passed to [[ModifyOp]].</td>
          </tr>
          <tr>
            <td>[[ModifyOp]]</td>
            <td>a <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref></td>
            <td>An abstract closure that returns a modified <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> from a read <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> and [[Payload]].</td>
          </tr>
        </tbody></table>
      </figure></emu-table>

      <p>These events are introduced by <emu-xref href="#sec-algorithm-conventions-abstract-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-abstract-operations">abstract operations</a></emu-xref> or by methods on the Atomics object.</p>
      <p>Some operations may also introduce <dfn>Synchronize</dfn> events. A <dfn variants="Synchronize events">Synchronize event</dfn> has no fields, and exists purely to directly constrain the permitted orderings of other events.</p>
      <p>In addition to <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref> and Synchronize events, there are <emu-xref href="#host"><a href="https://tc39.es/ecma262/#host">host</a></emu-xref>-specific events.</p>
      <p><ins>If the [[Storage]] field of a ReadSharedMemory, WriteSharedMemory, or ReadModifyWriteSharedMemory event is a SharedBlockStorage, then </ins><del>L</del><ins>l</ins>et <del>the</del><ins>its</ins> range of <del>a ReadSharedMemory, WriteSharedMemory, or ReadModifyWriteSharedMemory event</del> be the Set of contiguous <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integers</a></emu-xref> from its <ins>[[Storage]].</ins>[[ByteIndex]] to <ins>[[Storage]].</ins>[[ByteIndex]] + <ins>[[Storage]].</ins>[[ElementSize]] - 1. Two events' ranges are equal when the events <ins>have a SharedBlockStorage in their [[Storage]] field,</ins> have the same <ins>[[Storage]].</ins>[[Block]], and the ranges are element-wise equal. Two events' ranges are overlapping when the events have the same <ins>[[Storage]].</ins>[[Block]], the ranges are not equal and their intersection is non-empty. Two events' ranges are disjoint when the events do not <ins>both have a SharedBlockStorage in their [[Storage]] field, do not</ins> have the same <ins>[[Storage]].</ins>[[Block]]<ins>,</ins> or their ranges are neither equal nor overlapping.</p>
      <p><ins>If the [[Storage]] field of a ReadSharedMemory, WriteSharedMemory, or ReadModifyWriteSharedMemory event is a SharedStructStorage, then let its range be the value of the [[Storage]] field. Two events' ranges are equal when the events have a SharedStructStorage in their [[Storage]] field, have the same [[Storage]].[[Struct]] and the same [[Storage]].[[Field]]. Two events' ranges that both have a SharedStructStorage in their [[Storage]] field are never overlapping. Two events' ranges are disjoint when the events do not both have a SharedStructStorage in their [[Storage]] Field, or do not have the same [[Storage]].[[Struct]] or the same [[Storage]].[[Field]].</ins></p>
    </emu-clause>
  </emu-clause>
  <p>For brevity, the refactoring of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> relations to use <emu-xref href="#sec-memory-model-fundamentals" id="_ref_125"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> and the modified definition of event ranges is omitted.</p>
</emu-clause>

<emu-clause id="sec-shared-arrays">
  <h1><span class="secnum">3</span> Shared Array Object</h1>
  <p><dfn variant="Shared Array">Shared Arrays</dfn> are a special case of <emu-xref href="#shared-struct-exotic-object" id="_ref_126"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> with array indexed properties and an immutable <emu-val>"length"</emu-val> own property. Since they are <emu-xref href="#shared-struct-exotic-object" id="_ref_127"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref>, their layout, i.e. their length, is fixed at creation time.</p>

  <ins class="block">
  <emu-clause id="sec-shared-array-constructor">
    <h1><span class="secnum">3.1</span> The SharedArray Constructor</h1>
    <p>The SharedArray <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
    <ul>
      <li>is <dfn>%SharedArray%</dfn>.</li>
      <li>is the initial value of the <emu-val>"SharedArray"</emu-val> property of the <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</li>
      <li>creates and initializes a new Shared Array when called as a <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</li>
      <li>is not intended to be called as a function and will throw an exception when called in that manner.</li>
      <li>is a function whose behaviour differs based upon the number and types of its arguments.</li>
    </ul>

    <emu-clause id="sec-sharedarraycreate" type="abstract operation" aoid="SharedArrayCreate">
      <h1><span class="secnum">3.1.1</span> SharedArrayCreate ( <var>length</var> )</h1>
      <p>The abstract operation SharedArrayCreate takes argument <var>length</var> (an non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>) and returns a Shared Array. It is used to specify the creation of new <emu-xref href="#sec-shared-arrays" id="_ref_128"><a href="#sec-shared-arrays">Shared Arrays</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>length</var> ≤ 2<sup>32</sup> - 1.</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_129"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>A</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-val>null</emu-val>, « »).</li><li>Set <var>A</var>.[[GetOwnProperty]] as specified in <emu-xref href="#sec-shared-struct-getownproperty" id="_ref_9"><a href="#sec-shared-struct-getownproperty">2.1.4</a></emu-xref>.</li><li>Set <var>A</var>.[[DefineOwnProperty]] as specified in <emu-xref href="#sec-shared-struct-defineownproperty" id="_ref_10"><a href="#sec-shared-struct-defineownproperty">2.1.5</a></emu-xref>.</li><li>Set <var>A</var>.[[HasProperty]] as specified in <emu-xref href="#sec-shared-struct-hasproperty" id="_ref_11"><a href="#sec-shared-struct-hasproperty">2.1.6</a></emu-xref>.</li><li>Set <var>A</var>.[[Get]] as specified in <emu-xref href="#sec-shared-struct-get" id="_ref_12"><a href="#sec-shared-struct-get">2.1.7</a></emu-xref>.</li><li>Set <var>A</var>.[[Set]] as specified in <emu-xref href="#sec-shared-struct-set" id="_ref_13"><a href="#sec-shared-struct-set">2.1.8</a></emu-xref>.</li><li>Set <var>A</var>.[[Delete]] as specified in <emu-xref href="#sec-shared-struct-delete" id="_ref_14"><a href="#sec-shared-struct-delete">2.1.9</a></emu-xref>.</li><li>Let <var>k</var> be 0.</li><li>Repeat, while <var>k</var> &lt; <var>length</var>,<ol><li>Let <var>Pk</var> be !&nbsp;<emu-xref aoid="ToString"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>k</var>)).</li><li>Create an own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> named <var>Pk</var> of object <var>A</var> whose [[Value]] is <emu-val>undefined</emu-val>, [[Writable]] is <emu-val>true</emu-val>, [[Enumerable]] is <emu-val>true</emu-val>, and [[Configurable]] is <emu-val>false</emu-val>.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_130"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>A</var>, <var>Pk</var>, <emu-val>undefined</emu-val>, <emu-const>init</emu-const>).</li></ol></li><li>Create an own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> named <emu-val>"length"</emu-val> of object <var>A</var> whose [[Value]] is <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>length</var>), [[Writable]] is <emu-val>false</emu-val>, [[Enumerable]] is <emu-val>false</emu-val>, and [[Configurable]] is <emu-val>false</emu-val>.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_131"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>A</var>, <emu-val>"length"</emu-val>, <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>length</var>), <emu-const>init</emu-const>).</li><li>Perform !&nbsp;<var>A</var>.[[PreventExtensions]]().</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_132"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="TestIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-testintegritylevel">TestIntegrityLevel</a></emu-xref>(<var>A</var>, <emu-const>sealed</emu-const>) is <emu-val>true</emu-val>.</li><li>Return <var>A</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-sharedarray">
      <h1><span class="secnum">3.1.2</span> SharedArray ( ...<var>values</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>EDITOR'S NOTE: Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will give <emu-xref href="#sec-shared-arrays" id="_ref_133"><a href="#sec-shared-arrays">Shared Arrays</a></emu-xref> a per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototype with built-in methods.</li><li>Let <var>numberOfArgs</var> be the number of elements in <var>values</var>.</li><li>If <var>numberOfArgs</var> = 0, then<ol><li>Return <emu-xref aoid="SharedArrayCreate" id="_ref_134"><a href="#sec-sharedarraycreate">SharedArrayCreate</a></emu-xref>(0).</li></ol></li><li>Else if <var>numberOfArgs</var> = 1, then<ol><li>Let <var>len</var> be <var>values</var>[0].</li><li>If <var>len</var> is not an <emu-xref href="#integral-number"><a href="https://tc39.es/ecma262/#integral-number">integral Number</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>len</var> &lt; 0, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>lenReal</var> be <emu-xref aoid="ℝ"><a href="https://tc39.es/ecma262/#ℝ">ℝ</a></emu-xref>(<var>len</var>).</li><li>If <var>lenReal</var> &gt; 2<sup>32</sup> - 1, throw a <emu-val>RangeError</emu-val> exception.</li><li>Return <emu-xref aoid="SharedArrayCreate" id="_ref_135"><a href="#sec-sharedarraycreate">SharedArrayCreate</a></emu-xref>(<var>lenReal</var>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>numberOfArgs</var> ≥ 2.</li><li>Let <var>array</var> be <emu-xref aoid="SharedArrayCreate" id="_ref_136"><a href="#sec-sharedarraycreate">SharedArrayCreate</a></emu-xref>(<var>numberOfArgs</var>).</li><li>Let <var>k</var> be 0.</li><li>Repeat, while <var>k</var> &lt; <var>numberOfArgs</var>,<ol><li>Let <var>Pk</var> be !&nbsp;<emu-xref aoid="ToString"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>k</var>)).</li><li>Let <var>itemK</var> be <var>values</var>[<var>k</var>].</li><li>Perform !&nbsp;<emu-xref aoid="Set"><a href="https://tc39.es/ecma262/#sec-set-o-p-v-throw">Set</a></emu-xref>(<var>array</var>, <var>Pk</var>, <var>itemK</var>, <emu-val>true</emu-val>).</li><li>Set <var>k</var> to <var>k</var> + 1.</li></ol></li><li>Return <var>array</var>.</li></ol></li></ol></emu-alg>
    </emu-clause>
  </emu-clause>
  </ins>
</emu-clause><emu-annex id="sec-copyright-and-software-license">
      <h1><span class="secnum">A</span> Copyright &amp; Software License</h1>
      
      <h2>Copyright Notice</h2>
      <p>© 2024 Shu-yu Guo</p>

      <h2>Software License</h2>
      <p>All Software contained in this document ("Software") is protected by copyright and is being made available under the "BSD License", included below. This Software may be subject to third party rights (rights from parties other than Ecma International), including patent rights, and no licenses under such third party rights are granted under this license even if the third party concerned is a member of Ecma International. SEE THE ECMA CODE OF CONDUCT IN PATENT MATTERS AVAILABLE AT https://ecma-international.org/memento/codeofconduct.htm FOR INFORMATION REGARDING THE LICENSING OF PATENT CLAIMS THAT ARE REQUIRED TO IMPLEMENT ECMA INTERNATIONAL STANDARDS.</p>

<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>

<ol>
  <li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
  <li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
  <li>Neither the name of the authors nor Ecma International may be used to endorse or promote products derived from this software without specific prior written permission.</li>
</ol>

<p>THIS SOFTWARE IS PROVIDED BY THE ECMA INTERNATIONAL "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL ECMA INTERNATIONAL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>

    </emu-annex>
</div></body>